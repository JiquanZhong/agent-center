(this["webpackJsonpMyLibrary"]=this["webpackJsonpMyLibrary"]||[]).push([["chunk-773554b9"],{"07e1":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"counter-container"},[t("SystemList",{ref:"counterList",attrs:{title:"计数器管理",rowKey:"counterNumeric",columns:e.counterColumns,render:e.$bpmSystemProServices.systemService.getCounterList,params:e.counterParams,pagination:e.pagination,buttons:e.counterButtons,type:"checkbox",scroll:{y:e.scrollY}},on:{"update:pagination":function(t){e.pagination=t},change:e.onCounterListChange,rowClick:e.onRowClick,rowDbClick:e.onRowDbclick}},[t("template",{slot:"search-box"},[t("a-form",{attrs:{layout:"inline"}},[t("a-form-item",[t("a-input-search",{attrs:{placeholder:"请输入计数器名称","enter-button":"",allowClear:""},on:{search:e.onSearch},model:{value:e.counterParams.counterName,callback:function(t){e.$set(e.counterParams,"counterName",t)},expression:"counterParams.counterName"}})],1)],1)],1)],2),t("AddCounter",{attrs:{visible:e.addVisible,editData:e.editData,type:e.openType},on:{"update:visible":function(t){e.addVisible=t},"update:editData":function(t){e.editData=t},"update:edit-data":function(t){e.editData=t},submit:e.onCounterSubmit}})],1)},r=[],i=a("c7eb"),o=a("1da1"),s=(a("4de4"),a("a15b"),a("b0c0"),a("d3b7"),a("d8b8")),c=a("2a8a"),u={name:"Counter",created:function(){this.getResetStrategies(),this.getScrollY()},data:function(){var e=this,t=this;return{scrollY:null,addVisible:!1,editData:{},openType:"",counterParams:{counterName:""},selectedRows:[],selectedRowKeys:[],pagination:{pageIndex:1,pageSize:20,total:0},counterColumns:[{title:"计数器名称",dataIndex:"counterName",ellipsis:!0,width:"220px"},{title:"初始值",dataIndex:"initialValue",align:"center",width:"120px"},{title:"当前值",dataIndex:"currentValue",align:"center",width:"120px"},{title:"步长",dataIndex:"stepLength",align:"center",width:"120px"},{title:"清零规则",dataIndex:"resetStrategy",align:"center",ellipsis:!0,customRender:function(t){var a=e.resetStrategies.filter((function(e){return e.code===t}));return a.length>0?a[0].name:""}},{title:"创建时间",dataIndex:"currenttime",align:"center",ellipsis:!0,width:"220px"},{title:"备注",dataIndex:"description",ellipsis:!0}],counterButtons:[{id:1,text:"新增",icon:"iconfont-New",click:function(){t.editData={},t.openType="",t.addVisible=!0}},{id:2,text:"编辑",icon:"iconfont-Editor",click:function(){var e=t.$refs.counterList.getSelecteds();e&&e.length>1?t.$message.warning("请选择一条数据"):(t.editData=t.$refs.counterList.getSelected(),t.editData?(t.openType="edit",t.addVisible=!0):t.$message.warning("请选择要编辑的计数器"))}},{id:3,text:"删除",icon:"iconfont-Delete",click:function(){var e=t.$refs.counterList.getSelectedKeys();e&&e.length>0?t.$confirm({title:"提示",content:"确定删除记录?",okText:"确认",cancelText:"取消",onOk:function(){t.$bpmSystemProServices.systemService.deleteCounter({ids:e.join(",")}).then((function(e){e?(t.$message.success("删除成功"),t.$refs.counterList.clearSelected(),t.onSearch()):t.$message.error("删除失败")}))},onCancel:function(){}}):t.$message.warning("请选择要删除的计数器")}}]}},methods:{getScrollY:function(){var e=this;this.$nextTick((function(){var t=e.$refs.counterList.$el.querySelector(".ant-table-wrapper");e.scrollY=t.offsetHeight-115}))},getResetStrategies:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$bpmSystemProServices.systemService.getDictByCode("QLGZ");case 2:a=t.sent,e.resetStrategies=a;case 4:case"end":return t.stop()}}),t)})))()},onCounterListChange:function(e,t,a,n){n.currentDataSource;this.pagination.pageIndex=e.current,this.onSearch()},onSearch:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(o["a"])(Object(i["a"])().mark((function t(a,n){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.counterList.getListData();case 2:a();case 3:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})))()},onRowClick:function(e){this.editData=e},onRowDbclick:function(e){this.editData=e,this.openType="edit",this.addVisible=!0},onCounterSubmit:function(e){var t=this;return Object(o["a"])(Object(i["a"])().mark((function a(){return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.onSearch();case 2:e&&t.$refs.counterList.setSelectedRow(e);case 3:case"end":return a.stop()}}),a)})))()}},components:{SystemList:s["a"],AddCounter:c["default"]}},l=u,d=(a("fa68"),a("2877")),m=Object(d["a"])(l,n,r,!1,null,"0f07d7f9",null);t["default"]=m.exports},"160f":function(e,t,a){},"2a8a":function(e,t,a){"use strict";a.r(t);a("a4d3"),a("e01a"),a("b0c0");var n=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,visible:e.visible,okText:"确定",cancelText:"取消",centered:""},on:{"update:visible":function(t){e.visible=t},ok:e.handleOk,cancel:e.handleCancel}},[t("a-form-model",{ref:"form",attrs:{model:e.formData,layout:"horizontal","label-col":{span:4},"wrapper-col":{span:20}}},[t("a-form-model-item",{attrs:{label:"计数器名称",prop:"counterName"}},[t("a-input",{model:{value:e.formData.counterName,callback:function(t){e.$set(e.formData,"counterName",t)},expression:"formData.counterName"}})],1),t("a-form-model-item",{attrs:{label:"初始值",prop:"initialValue"}},[t("a-input-number",{model:{value:e.formData.initialValue,callback:function(t){e.$set(e.formData,"initialValue",t)},expression:"formData.initialValue"}})],1),t("a-form-model-item",{attrs:{label:"当前值",prop:"currentValue"}},[t("a-input-number",{model:{value:e.formData.currentValue,callback:function(t){e.$set(e.formData,"currentValue",t)},expression:"formData.currentValue"}})],1),t("a-form-model-item",{attrs:{label:"步长",prop:"stepLength"}},[t("a-input-number",{model:{value:e.formData.stepLength,callback:function(t){e.$set(e.formData,"stepLength",t)},expression:"formData.stepLength"}})],1),t("a-form-model-item",{attrs:{label:"清零规则",prop:"resetStrategy"}},[t("a-select",{model:{value:e.formData.resetStrategy,callback:function(t){e.$set(e.formData,"resetStrategy",t)},expression:"formData.resetStrategy"}},e._l(e.resetStrategies,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.code}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-model-item",{attrs:{label:"备注",prop:"description"}},[t("a-textarea",{attrs:{placeholder:"备注","auto-size":{minRows:3,maxRows:5}},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1)],1)],1)},r=[],i=a("c7eb"),o=a("1da1"),s={name:"AddCounter",props:{visible:{type:Boolean,default:!1,required:!0},editData:{type:Object,required:!1,default:function(){return{}}},type:{type:String,default:"",required:!1}},mounted:function(){this.getResetStrategies()},data:function(){return{resetStrategies:[],formData:{counterNumeric:"",counterName:"",initialValue:"",currentValue:"",stepLength:"",resetStrategy:"",description:""}}},computed:{title:function(){var e="新增";return"edit"===this.type&&(e="编辑"),"".concat(e,"计数器")}},watch:{visible:function(e){var t=this;e?this.$nextTick((function(){t.resetFormData(),"edit"===t.type&&(t.formData=Object.assign(t.formData,t.editData))})):this.resetFormData()}},methods:{getResetStrategies:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$bpmSystemProServices.systemService.getDictByCode("QLGZ");case 2:a=t.sent,e.resetStrategies=a;case 4:case"end":return t.stop()}}),t)})))()},resetFormData:function(){for(var e in this.formData)this.formData[e]=""},handleOk:function(){var e=this;this.$bpmSystemProServices.systemService.saveCounter(this.formData).then((function(t){t?(e.$message.success("保存成功"),e.$emit("submit",e.formData.counterNumeric)):e.$message.error("保存失败"),e.$emit("update:visible",!1)}))},handleCancel:function(){this.$emit("update:visible",!1)}}},c=s,u=a("2877"),l=Object(u["a"])(c,n,r,!1,null,null,null);t["default"]=l.exports},fa68:function(e,t,a){"use strict";a("160f")}}]);