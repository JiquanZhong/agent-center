import{_ as U}from"./SvgIcon-Dqw9D6KB.js";import{a as D,M as b,I as z}from"./ant-design-vue-N94YJPlZ.js";import{l,f as j,o as Q,P as u,Z as a,c as _,Q as W,u as d,D as N,F as S,a1 as R,S as m,a3 as $,X,a2 as Y,$ as Z,y as A,z as G,_ as T}from"./@vue-CFjPwn9D.js";import{b as q,_ as J}from"./index-DMNcVszy.js";import{c as K}from"./index-BfUSGbfi.js";import{u as tt,b as et}from"./vue-router-2RbTs74B.js";import"./@babel-CuAkI3ff.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-DoMtMbyJ.js";import"./@ant-design-DyEdRgPf.js";import"./@ctrl-3cdSgQbg.js";import"./lodash-es-mOee43Rj.js";import"./vue-types-B67A5qzE.js";import"./axios-upsvKRUO.js";import"./pinia-BYoSazbl.js";const st=""+new URL("../img/logo.png",import.meta.url).href;class ot{constructor(){}getConversations(i="",n=50){return q({url:"/v1/conversations",method:"get",params:{last_id:i,limit:n}})}deleteConversation(i){const n={url:`/v1/conversations/${i}`,method:"delete"};return q(n)}updateConversationName(i,n="",y=!1){const v={url:`/v1/conversations/${i}/name`,method:"post",data:{name:n,auto_generate:y}};return q(v)}}const at={today:"今天",yesterday:"昨天",thisWeek:"本周",earlier:"更早"},nt={class:"history"},it={class:"history-list"},rt={key:0,class:"categorize-title"},lt=["onClick","onMouseover"],ct={class:"history-list-item-title"},ut={class:"history-list-item-operating-button"},dt={class:"time"},mt={style:{display:"flex"}},vt={__name:"index",emits:["toggle","setChatTitle"],setup(I,{emit:i}){const n=new ot;l(!1);const y=i,v=l(""),r=l(""),M=l([]),p=l(!1),f=l(""),c=l(""),H=tt(),O=et(),C=j(()=>K(M.value));Q(async()=>{await k()});const P=e=>{const t=new Date(e),w=t.getFullYear(),x=(t.getMonth()+1).toString().padStart(2,"0"),h=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return`${w}-${x}-${h} ${o}:${s}`},k=async()=>{const e=await n.getConversations();M.value=[...e.data]},L=e=>{r.value=e.id,O.push({name:"chat",query:{...H.query,chooseKey:r.value}})},V=()=>{r.value="",y("setChatTitle","");var e=document.querySelector("#ai-chat");e.newChat()},B=e=>{f.value=e.id,p.value=!0,c.value=e.name},E=async()=>{p.value=!1,(await n.updateConversationName(f.value,c.value)).id===f.value&&(f.value="",c.value="",D.success("修改成功"),k())},F=e=>{b.confirm({title:"确认删除聊天记录?",content:"删除后，聊天记录不可恢复",okText:"确定",cancelText:"取消",onOk(){return n.deleteConversation(e).then(t=>{t.result==="success"&&(D.success("删除成功"),e===r.value&&(r.value="",V()),k())})},onCancel(){}})};return(e,t)=>{const w=z,x=b,h=U;return m(),u("div",nt,[t[3]||(t[3]=a("div",{class:"brand"},[a("div",{class:"title"},[a("div",{class:"logo"},[a("img",{src:st})]),a("h5",null,"聊天机器人")])],-1)),_(x,{visible:d(p),"onUpdate:visible":t[1]||(t[1]=o=>N(p)?p.value=o:null),title:"编辑对话名称","cancel-text":"取消","ok-text":"确认",onOk:E},{default:W(()=>[_(w,{value:d(c),"onUpdate:value":t[0]||(t[0]=o=>N(c)?c.value=o:null),"show-count":"",maxlength:30},null,8,["value"])]),_:1},8,["visible"]),a("div",it,[(m(!0),u(S,null,R(Object.keys(C.value),o=>(m(),u(S,{key:o},[C.value[o].length!==0?(m(),u("div",rt,$(d(at)[o]),1)):X("",!0),(m(!0),u(S,null,R(C.value[o],s=>(m(),u("div",{key:s.id,class:Y(["history-list-item",{"hisory-list-item-choosed":d(r)===s.id}]),onClick:g=>L(s),onMouseover:g=>v.value=s.id,onMouseleave:t[2]||(t[2]=g=>v.value="")},[a("div",ct,[_(h,{name:"list-chat"}),Z(" "+$(s.name),1)]),a("div",ut,[a("div",dt,$(P(s.created_at*1e3)),1),A(a("div",mt,[_(h,{name:"edit",onClick:T(g=>B(s),["stop"])},null,8,["onClick"]),_(h,{name:"delete",onClick:T(g=>F(s.id),["stop"])},null,8,["onClick"])],512),[[G,d(v)===s.id||d(r)===s.id]])])],42,lt))),128))],64))),128))])])}}},bt=J(vt,[["__scopeId","data-v-d12a265a"]]);export{bt as default};
