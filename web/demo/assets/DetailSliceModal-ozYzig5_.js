import{g as Z,_ as ee,T as te,B as ae,I as ne,F as oe,a as A,M as se,x as le,y as ie,z as ce,A as ue}from"./ant-design-vue--Wr84Izy.js";import{r as o,o as R,a0 as u,$ as g,a1 as d,c as r,u as e,a5 as z,F as L,a8 as N,G as W,a7 as F,H as D,a as re,a2 as v,a6 as de,D as pe,e as _e}from"./@vue-B5btswkz.js";import{h as ve,i as me,j as Q}from"./knowledge-4fmUvZpN.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{W as H,T as fe}from"./@ant-design-B-ejxF28.js";import{c as ge}from"./index-BsLPKckO.js";const he={__name:"SliceEdit",props:{curSliceObj:{type:Object,default:null}},setup(b,{expose:T}){const i=o({}),p=o(""),k=o(!1),m=o(""),h=o(!1),C=b;R(()=>{const{content:t,important_keywords:s,questions:O}=C.curSliceObj;i.value={content:t,important_keywords:s,questions:O}});const f=()=>{k.value=!0},w=()=>{h.value=!0},x=t=>{i.value.important_keywords=[...i.value.important_keywords.filter(s=>s!==t)]},$=t=>{i.value.questions=[...i.value.questions.filter(s=>s!==t)]},_=()=>{k.value=!1,h.value=!1,p.value&&i.value.important_keywords.push(p.value),m.value&&i.value.questions.push(p.value),p.value="",m.value=""};return T({sliceData:i}),(t,s)=>{const O=Z,S=ee,M=te,U=ae,B=ne,q=oe;return u(),g(q,{ref:"formRef",layout:"vertical",name:"form_in_modal",style:{"margin-top":"10px"}},{default:d(()=>[r(S,{name:"",label:"解析块：:"},{default:d(()=>[r(O,{value:e(i).content,disabled:!0,rows:5},null,8,["value"])]),_:1}),r(S,{name:"",label:"关键词："},{default:d(()=>[(u(!0),z(L,null,N(e(i).important_keywords,c=>(u(),g(M,{closable:"",onClose:K=>x(c),key:c},{default:d(()=>[W(F(c),1)]),_:2},1032,["onClose"]))),128)),e(k)?(u(),g(B,{key:1,value:e(p),"onUpdate:value":s[0]||(s[0]=c=>D(p)?p.value=c:null),style:{"margin-top":"15px"},onBlur:_},null,8,["value"])):(u(),g(U,{key:0,class:"add-btn",onClick:f},{icon:d(()=>[r(e(H))]),_:1}))]),_:1}),r(S,{name:"",label:"问题："},{default:d(()=>[(u(!0),z(L,null,N(e(i).questions,c=>(u(),g(M,{closable:"",onClose:K=>$(c),key:c},{default:d(()=>[W(F(c),1)]),_:2},1032,["onClose"]))),128)),e(h)?(u(),g(B,{key:1,value:e(m),"onUpdate:value":s[1]||(s[1]=c=>D(m)?m.value=c:null),onBlur:_,style:{"margin-top":"15px"}},null,8,["value"])):(u(),g(U,{key:0,class:"add-btn",onClick:w,style:{"margin-top":"15px"}},{icon:d(()=>[r(e(H))]),_:1}))]),_:1})]),_:1},512)}}},ye=G(he,[["__scopeId","data-v-3f99e723"]]),ke={class:"slice-main"},we={class:"pdf"},Se=["src"],be={class:"slice-content"},Ce={class:"slice-list"},Oe={class:"list-main beautify-scrollbar"},ze={class:"slice-top"},xe={class:"seq"},$e={key:0,class:"operate-btn"},Me=["onClick"],Ue=["innerHTML","onClick"],Be={__name:"DetailSliceModal",props:{modalOpen:{type:Boolean,default:!1},title:{type:String,default:""},documentId:{type:String,default:""},chunkPosition:{type:String,default:""}},emits:["update:modalOpen"],setup(b,{emit:T}){const i=o(ge().isAdministrator()),p=o("1");o(6);const k=o(""),m=o([]),h=o(""),C=o(""),f=o(null),w=o(null),x=o(null),$=o(""),_=b,t=re({current:1,pageSize:10,total:50,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:a=>`共 ${a} 条`}),s=o(!1);R(async()=>{I();const a=await ve(_.documentId);C.value=a.previewUrl,h.value="/ai_center",$.value="/ai_center",f.value.contentWindow.postMessage({documentUrl:`${h.value}${C.value}`},"*"),_.chunkPosition&&f.value.contentWindow.postMessage({chunk:_.chunkPosition},"*")});const O=()=>{f.value.contentWindow.postMessage({documentUrl:`${h.value}${C.value}`},"*"),_.chunkPosition&&f.value.contentWindow.postMessage({chunk:_.chunkPosition},"*")},S=T,M=a=>{s.value=!0,w.value=a},U=async()=>{const a=x.value.sliceData;await Q(_.documentId,w.value.id,{available:w.value.available,...a}),A.success("保存成功"),I(),s.value=!1},B=async a=>{const{content:n,important_keywords:y,questions:P}=a,j={content:n,important_keywords:y,questions:P};await Q(_.documentId,a.id,{available:!a.available,...j}),I()},q=()=>{S("update:modalOpen",!1)},c=()=>{S("update:modalOpen",!1)},K=a=>{k.value=a.id;const n=a.positions;f.value.contentWindow.postMessage({chunk:JSON.stringify(n)},"*")},I=async(a={})=>{try{const n={page:t.current,pageSize:t.pageSize},y=await me(_.documentId,n);t.total=y.data.total,m.value=y.data.chunks,console.log("Fetch data with params:",a)}catch{A.error("数据加载失败")}finally{}},J=()=>{I()};return(a,n)=>{const y=se,P=le,j=ie,Y=ce,X=ue;return u(),g(y,{style:{width:"100vw",top:0,paddingBottom:0,maxWidth:"auto",margin:"0px"},bodyStyle:{height:"calc(100vh - 55px)",overflowY:"auto",padding:"0px"},visible:b.modalOpen,title:b.title,"cancel-text":"取消","ok-text":"确认",onOk:q,onCancel:c,footer:null,destroyOnClose:!0},{default:d(()=>[r(y,{visible:e(s),"onUpdate:visible":n[0]||(n[0]=l=>D(s)?s.value=l:null),title:"编辑解析块","cancel-text":"取消","ok-text":"保存",onOk:U,destroyOnClose:!0,style:{width:"40%"}},{default:d(()=>[r(ye,{curSliceObj:e(w),ref_key:"sliceEdit",ref:x},null,8,["curSliceObj"])]),_:1},8,["visible"]),v("div",ke,[v("div",we,[v("iframe",{src:`${e($)}/pdf-view/index.html`,onLoad:O,ref_key:"iframe",ref:f,style:{width:"100%",height:"100%"}},null,40,Se)]),v("div",be,[r(X,{activeKey:e(p),"onUpdate:activeKey":n[3]||(n[3]=l=>D(p)?p.value=l:null)},{default:d(()=>[r(Y,{key:"1",tab:`段落（${e(t).total}）`},{default:d(()=>[v("div",Ce,[v("div",Oe,[(u(!0),z(L,null,N(e(m),(l,E)=>(u(),z("div",{class:de(["list-item",{"choosed-slice":e(k)===l.id}]),key:l.id},[v("div",ze,[v("div",xe,F((e(t).current-1)*e(t).pageSize+E+1<10?`0${E+1}`:(e(t).current-1)*e(t).pageSize+E+1)+". ",1),e(i)?(u(),z("div",$e,[v("div",null,[r(P,{checked:l.available,onChange:V=>B(l)},null,8,["checked","onChange"])]),v("div",{onClick:pe(V=>M(l),["stop"]),class:"edit-btn"},[r(e(fe)),n[4]||(n[4]=W("编辑"))],8,Me)])):_e("",!0)]),v("div",{class:"content",innerHTML:l.content,onClick:V=>K(l)},null,8,Ue)],2))),128))]),r(j,{current:e(t).current,"onUpdate:current":n[1]||(n[1]=l=>e(t).current=l),"page-size":e(t).pageSize,"onUpdate:pageSize":n[2]||(n[2]=l=>e(t).pageSize=l),total:e(t).total,"show-total":e(t).showTotal,showSizeChanger:e(t).showSizeChanger,pageSizeOptions:e(t).pageSizeOptions,onChange:J},null,8,["current","page-size","total","show-total","showSizeChanger","pageSizeOptions"])])]),_:1},8,["tab"])]),_:1},8,["activeKey"])])])]),_:1},8,["visible","title"])}}},je=G(Be,[["__scopeId","data-v-0aa42cd5"]]);export{je as D};
