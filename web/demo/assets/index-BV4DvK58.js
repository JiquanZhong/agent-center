import{a as Y,I as ne,M as z,c as ie}from"./ant-design-vue-D2rNv0Za.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as re,j as X,Y as g,a4 as y,_ as s,a5 as le,r as v,o as B,t as E,A as M,u as r,c,Z as b,G as V,E as L,F as N,a6 as G,a7 as K,a1 as O,a8 as U,B as j,a2 as ce}from"./@vue-Dw5Xbrmr.js";import{b as q,u as Q,c as ue,C as de,a as me}from"./index-fnIswVQC.js";import"./@babel-CMLFsLIC.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./lodash-es-DTyaW6b9.js";import"./async-validator-P8scd9xB.js";import"./@ant-design-DxBmdqxm.js";import"./@ctrl-3cdSgQbg.js";import"./scroll-into-view-if-needed-BYx7v0DY.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./dayjs-BkTfh5k6.js";import"./vue-types-B67A5qzE.js";import"./dom-align-OCOKWGcj.js";import"./axios-upsvKRUO.js";import"./vue-router-De4T6OwY.js";import"./pinia-KBq3_NPl.js";const he=re({name:"SvgIcon",props:{prefix:{type:String,default:"icon"},name:{type:String,required:!0},color:{type:String,default:"#333"}},setup(m){return{symbolId:X(()=>`#${m.prefix}-${m.name}`)}}}),pe={"aria-hidden":"true"},ve=["href","fill"];function ge(m,e,o,u,h,p){return g(),y("svg",pe,[s("use",{href:m.symbolId,fill:m.color},null,8,ve)])}const ye=I(he,[["render",ge],["__scopeId","data-v-75a038b6"]]),fe=""+new URL("logo-DkbGtkiM.png",import.meta.url).href,W="data:image/png;base64,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",$=""+new URL("logo-hide-ChP2Srgt.png",import.meta.url).href;class we{constructor(e){this.user=e}stopChatMessage(e){const o={url:`/v1/chat-messages/${e}/stop`,method:"post",data:JSON.stringify({user:this.user})};return q(o)}getConversations(e="",o=50){const u={url:"/v1/conversations",method:"get",params:{user:this.user,last_id:e,limit:o}};return q(u)}deleteConversation(e){const o={url:`/v1/conversations/${e}`,method:"delete",data:{user:this.user}};return q(o)}updateConversationName(e,o="",u=!1){const h={url:`/v1/conversations/${e}/name`,method:"post",data:{name:o,auto_generate:u,user:this.user}};return q(h)}}const Ce=m=>{const e=new Date;e.setHours(0,0,0,0);const o=new Date(e),u=new Date(e);u.setDate(e.getDate()-1);const h=new Date(e);h.setDate(e.getDate()-(e.getDay()+6)%7);const p=new Date(h);p.setDate(h.getDate()+6);const a={today:[],yesterday:[],thisWeek:[],earlier:[]};return m.forEach(n=>{const l=new Date(n.created_at*1e3);l.setHours(0,0,0,0),l.getTime()===o.getTime()?a.today.push(n):l.getTime()===u.getTime()?a.yesterday.push(n):l>=h&&l<=p?a.thisWeek.push(n):a.earlier.push(n)}),a},_e={today:"今天",yesterday:"昨天",thisWeek:"本周",earlier:"更早"},be={class:"sidebar-menu"},ke={class:"sidebar-menu"},Se={class:"logo"},xe={class:"search"},Ae={class:"history-list"},De={key:0,class:"categorize-title"},Te=["onClick","onMouseover"],Re={class:"history-list-item-title"},qe={class:"history-list-item-operating-button"},Ne={class:"hide-status-menu"},Ie={class:"hide-menu"},Fe={__name:"index",emits:["toggle","setChatTitle"],async setup(m,{emit:e}){let o,u;const h=([o,u]=le(()=>Q().getCurrentUser()),o=await o,u(),o),{logout:p}=ue(),a=new we(h.id),n=v(""),l=v(!1),S=e,F=v(""),C=v(""),x=v([]),k=v(!1),A=v(""),_=v(""),D=X(()=>Ce(x.value));B(async()=>{await T();var i=document.querySelector("#ai-chat");i.addEventListener("ai-chat-aiFirstAnswer",async t=>{await T(),C.value=x.value[0].id,S("setChatTitle",x.value[0].name)})});const T=async()=>{const i=await a.getConversations();x.value=[...i.data],console.log(D.value)},ee=i=>{C.value=i.id;var t=document.querySelector("#ai-chat");t.switchChatSessions(i.id),S("setChatTitle",i.name)},H=()=>{C.value="",S("setChatTitle","");var i=document.querySelector("#ai-chat");i.newChat()},Z=()=>{S("toggle"),l.value?setTimeout(()=>{l.value=!l.value},150):l.value=!l.value},te=i=>{A.value=i.id,k.value=!0,_.value=i.name},se=async()=>{k.value=!1,(await a.updateConversationName(A.value,_.value)).id===A.value&&(A.value="",_.value="",Y.success("修改成功"),T())},oe=i=>{z.confirm({title:"确认删除聊天记录?",content:"删除后，聊天记录不可恢复",okText:"确定",cancelText:"取消",onOk(){return a.deleteConversation(i).then(t=>{t.result==="success"&&(Y.success("删除成功"),i===C.value&&(C.value="",H()),T())})},onCancel(){}})};return(i,t)=>{const P=ne,ae=z,w=ye,J=ie;return g(),y("div",be,[E(s("div",ke,[c(ae,{visible:r(k),"onUpdate:visible":t[1]||(t[1]=d=>V(k)?k.value=d:null),title:"编辑对话名称","cancel-text":"取消","ok-text":"确认",onOk:se},{default:b(()=>[c(P,{value:r(_),"onUpdate:value":t[0]||(t[0]=d=>V(_)?_.value=d:null),"show-count":"",maxlength:30},null,8,["value"])]),_:1},8,["visible"]),s("div",Se,[t[6]||(t[6]=s("img",{src:fe},null,-1)),c(w,{name:"sidebar",style:{width:"22px",height:"22px",cursor:"pointer"},onClick:Z})]),s("div",{class:"new-chat",onClick:H},[c(w,{name:"newChat",style:{width:"22px",height:"22px"}}),t[7]||(t[7]=L(" 新建对话 "))]),s("div",xe,[c(P,{value:r(n),"onUpdate:value":t[2]||(t[2]=d=>V(n)?n.value=d:null),placeholder:"搜索历史记录",style:{height:"40px","border-radius":"8px"}},{prefix:b(()=>[c(w,{name:"search",style:{width:"16px",height:"16px"}})]),_:1},8,["value"])]),s("div",Ae,[(g(!0),y(N,null,G(Object.keys(D.value),d=>(g(),y(N,{key:d},[D.value[d].length!==0?(g(),y("div",De,K(r(_e)[d]),1)):O("",!0),(g(!0),y(N,null,G(D.value[d],f=>(g(),y("div",{key:f.id,class:U(["history-list-item",{"hisory-list-item-choosed":r(C)===f.id}]),onClick:R=>ee(f),onMouseover:R=>F.value=f.id,onMouseleave:t[3]||(t[3]=R=>F.value="")},[s("div",Re,K(f.name),1),E(s("div",qe,[c(w,{name:"edit",onClick:j(R=>te(f),["stop"])},null,8,["onClick"]),c(w,{name:"download"}),c(w,{name:"delete",onClick:j(R=>oe(f.id),["stop"])},null,8,["onClick"])],512),[[M,r(F)===f.id||r(C)===f.id]])],42,Te))),128))],64))),128))]),c(J,{title:"",trigger:"click",placement:"right"},{content:b(()=>[s("div",{class:"login-out",onClick:t[4]||(t[4]=(...d)=>r(p)&&r(p)(...d))},"注销")]),default:b(()=>[t[8]||(t[8]=s("div",{class:"sidebar-bottom"},[s("img",{src:W}),L("用户信息 ")],-1))]),_:1})],512),[[M,!r(l)]]),E(s("div",Ne,[s("div",null,[t[9]||(t[9]=s("img",{src:$,style:{width:"30px",height:"30px"}},null,-1)),s("div",Ie,[c(w,{name:"sidebar",style:{width:"22px",height:"22px",cursor:"pointer"},onClick:Z}),c(w,{name:"newChat",style:{width:"22px",height:"22px"},onClick:H})])]),c(J,{title:"",trigger:"click",placement:"right"},{content:b(()=>[s("div",{class:"login-out",onClick:t[5]||(t[5]=(...d)=>r(p)&&r(p)(...d))},"注销")]),default:b(()=>[t[10]||(t[10]=s("div",{class:"hide-user",style:{cursor:"pointer"}},[s("img",{src:W})],-1))]),_:1})],512),[[M,r(l)]])])}}},He=I(Fe,[["__scopeId","data-v-a5312891"]]),Ee={key:0,class:"chat-home-page"},Me={__name:"index",props:{showHome:{type:Boolean,default:!0}},emits:["setShowHome"],setup(m,{emit:e}){const o=me(),u=e;B(()=>{h()});const h=async()=>{const p=o.get(de.TOKEN_NAME),a=await Q().getCurrentUser();debugger;window.DiitAiChat.register("ai-chat","/lib/chatTheme.css");var n=document.querySelector("#ai-chat");n.chatConfig={mode:"complex",brand:{logo:"./img/logo.png",title:"聊天机器人",isShow:!1},robot:{avatar:"./img/robot.png"},user:{avatar:""},systemFirstComponent:"",messages:[{code:"system",data:{text:""}},{code:"robot",data:{text:""}}],placeholder:"",sidebar:{customComponent:null},bottomTip:"",apiConfig:{url:window.houtuServeConfig.url,apiKey:p,user:a.id}},n.addEventListener("ai-chat-sendFirstChat",()=>{u("setShowHome");var l=document.querySelector("#ai-chat");l.newChat()})};return(p,a)=>{const n=ce("ai-chat");return g(),y(N,null,[m.showHome?(g(),y("div",Ee,a[0]||(a[0]=[s("div",{class:"main"},[s("div",{class:"logo"},[s("img",{src:$}),L(" 国土空间基础信息平台 | 后土应用 ")]),s("div",{class:"describe"}," 作为你的智能伙伴，我既能写文案、想点子，又能陪你聊天、答疑解惑～ ")],-1)]))):O("",!0),c(n,{id:"ai-chat",class:U({"home-page":m.showHome}),style:{width:"100%"}},null,8,["class"]),a[1]||(a[1]=s("div",{class:"bottom-tip"}," 服务生成的所有内容均由人工智能模型生成，其生成内容的准确性和完整性无法保证，请注意甄别 ",-1))],64)}}},Ve=I(Me,[["__scopeId","data-v-5e468ba5"]]),Le={class:"ht-app"},Ke={class:"main"},Oe={key:0,class:"main-header"},Ue={class:"main-view"},Ze={__name:"index",setup(m){const e=v(!0),o=v(!1),u=v(""),h=()=>{o.value=!o.value},p=n=>{e.value=!1,u.value=n},a=()=>{e.value=!1};return(n,l)=>(g(),y("div",Le,[s("div",{class:U(["sidebar",{collapsed:r(o)}])},[c(He,{onToggle:h,onSetChatTitle:p})],2),s("div",Ke,[r(e)?O("",!0):(g(),y("header",Oe,K(r(u)),1)),s("main",Ue,[c(Ve,{"show-home":r(e),onSetShowHome:a},null,8,["show-home"])])])]))}},rt=I(Ze,[["__scopeId","data-v-1207b16d"]]);export{rt as default};
