import{r as s,w as lt,a0 as p,a5 as k,u as t,$ as ct,H as O,e as W,a2 as e,a7 as x,c as r,a1 as R,G as A,o as Z,a6 as q,v as $,B as H,a9 as rt,F as U,Z as ut,aa as dt,b as ht,D as B,a8 as z,k as mt}from"./@vue-B5btswkz.js";import{B as pt,a as G,M as V,I as vt}from"./ant-design-vue--Wr84Izy.js";import{_ as J}from"./SvgIcon-D33RiJgU.js";import{D as _t}from"./DetailSliceModal-ozYzig5_.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as Q,u as F,C as ft,a as kt,D as yt,d as wt}from"./index-BsLPKckO.js";import{d as Ct}from"./pinia-DuIsOk5z.js";import{b as X,u as gt}from"./vue-router-D8gsG8iB.js";import{l as St}from"./lodash-BTFGF6yz.js";import{_ as bt}from"./LogoHeader--O6zm5Mr.js";import"./@babel-Dd5QU_Ri.js";import"./@ant-design-B-ejxF28.js";import"./@ctrl-3cdSgQbg.js";import"./lodash-es-CSO40SSR.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-bdfbxlhH.js";import"./vue-types-B67A5qzE.js";import"./dom-align-OCOKWGcj.js";import"./async-validator-P8scd9xB.js";import"./scroll-into-view-if-needed-BYx7v0DY.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./knowledge-4fmUvZpN.js";import"./axios-upsvKRUO.js";import"./vxe-pc-ui-B3rMWPmo.js";import"./xe-utils-BVyeMf_3.js";import"./@vxe-ui-ivSiCnOc.js";import"./dom-zindex-DlWB42XF.js";import"./vxe-table-CY8UZVkh.js";const xt={class:"link-content"},Lt={class:"link-list"},Tt={class:"link-list-item"},$t={class:"item-content beautify-scrollbar"},Ht={class:"item-file-link"},It={class:"file-name"},Mt={__name:"linkContent",props:{chunk:{type:Object,default:()=>{}}},emits:"closeLink",setup(v,{emit:b}){s("8"),s(null),s("");const u=s(""),h=s(""),y=s(""),d=s(!1),c=s(""),i=s(""),S=v,m=b,_=()=>{m("closeLink")},f=()=>{d.value=!0};return lt(()=>S.chunk,n=>{u.value=n.preview_url,c.value=n.positions,h.value=n.document_Keyword,y.value=n.document_id,i.value=n.content}),(n,l)=>{const C=J,I=pt;return p(),k("div",xt,[t(d)?(p(),ct(_t,{key:0,modalOpen:t(d),"onUpdate:modalOpen":l[0]||(l[0]=E=>O(d)?d.value=E:null),title:t(h),documentId:t(y),chunkPosition:t(c)},null,8,["modalOpen","title","documentId","chunkPosition"])):W("",!0),e("div",{class:"header"},[l[1]||(l[1]=e("div",{class:"title"},[e("h3",null,"引用资料")],-1)),e("div",{class:"close-btn",onClick:_},"✕")]),e("div",Lt,[e("div",Tt,[e("div",$t,x(t(i)),1),e("div",Ht,[e("div",null,[r(C,{name:"pdf",style:{width:"25px",height:"25px"}})]),e("div",It,[e("div",null,x(t(h)),1)]),e("div",null,[r(I,{style:{background:"#4180ff","border-radius":"5px",color:"white"},onClick:f},{default:R(()=>l[2]||(l[2]=[A("阅读原文")])),_:1})])])])])])}}},Dt=N(Mt,[["__scopeId","data-v-2a501594"]]),P=Ct("chat",{state:()=>({showLink:!1}),getters:{},actions:{setShowLink(v){this.showLink=v}}}),Bt={key:0,class:"chat-home-page"},Ot={class:"main"},Ut={class:"logo"},qt=["src"],Nt={class:"describe"},Et={key:1,class:"main-header"},Rt={__name:"chat",props:{showHome:{type:Boolean,default:!0},chatTitle:{type:String,default:""}},emits:["setShowHome"],setup(v,{emit:b}){const u=Q();F();const h=kt(),y=s(null),d=b,c=P(),i=X();Z(()=>{S()});const S=async()=>{const{agentId:m}=i.query,_=h.get(ft.TOKEN_NAME),f=await F().getCurrentUser();try{window.DiitAiChat.register("ai-chat","/ai_center/lib/chatTheme.css")}catch{var n=document.querySelector("#ai-chat")}finally{var n=document.querySelector("#ai-chat")}n.chatConfig={mode:"complex",loading:"progress",agentId:m,deepTinkType:window.houtuServeConfig.deepTinkType,brand:{logo:"",title:"",isShow:!1},deepThinkBtn:{...window.houtuServeConfig.chatDeepThinkBtn},knowledgeBtn:{defaultStatus:!1,isShow:!0},robot:{avatar:"./img/robot.png"},user:{avatar:""},systemFirstComponent:"",messages:[{code:"system",data:{text:""}},{code:"robot",data:{text:""}}],placeholder:"",sidebar:{customComponent:null},bottomTip:"",apiConfig:{url:"/ai_center",apiKey:_,user:f.id}},n.newChat();const{question:l}=i.query;l&&n.sendChat(decodeURIComponent(l)),n.addEventListener("ai-chat-sendFirstChat",()=>{d("setShowHome",!1)}),n.addEventListener("ai-chat-clickSubscript",C=>{y.value=C.detail[0],c.setShowLink(!0)})};return(m,_)=>{const f=ut("ai-chat");return p(),k(U,null,[v.showHome?(p(),k("div",Bt,[e("div",Ot,[e("div",Ut,[e("img",{src:t(u).logoImgUrl},null,8,qt),A(" "+x(t(u).gjMode?' 自然资源行业"后土"大模型':t(u).logoName),1)]),e("div",Nt,x(t(u).appDescription),1)])])):(p(),k("header",Et,x(v.chatTitle),1)),e("div",{class:"chat-main",style:rt({height:v.showHome?"auto":""})},[r(f,{id:"ai-chat",class:q({"home-page":v.showHome}),style:{width:"100%"}},null,8,["class"]),$(r(Dt,{onCloseLink:_[0]||(_[0]=n=>t(c).setShowLink(!1)),chunk:t(y)},null,8,["chunk"]),[[H,t(c).showLink&&!v.showHome]])],4),e("div",{class:q(["bottom-tip",{"bottom-tip-shrink":t(c).showLink}])}," 服务生成的所有内容均由人工智能模型生成，其生成内容的准确性和完整性无法保证，请注意甄别 ",2)],64)}}},Ft=N(Rt,[["__scopeId","data-v-dc1d871e"]]),At={today:"今天",yesterday:"昨天",thisWeek:"本周",earlier:"更早"},Pt={class:"chat-history"},jt={class:"history-main"},Kt={class:"history-top"},zt={class:"history-list"},Gt={key:0,class:"categorize-title"},Vt=["onClick","onMouseover"],Wt={class:"history-list-item-title"},Zt={class:"history-list-item-operating-button"},Jt={__name:"historyList",emits:["toggle","setChatTitle","setShowHome"],async setup(v,{emit:b}){let u,h;const y=([u,h]=dt(()=>F().getCurrentUser()),u=await u,h(),u),d=new yt(y.id),c=s("");s(!1);const i=b,S=s(""),m=s(""),_=s([]),f=s(!1),n=s(""),l=s("");gt(),X(),s(""),s(""),s(!1);const C=s(!1),I=P(),E=()=>{C.value=!0},M=ht(()=>wt(_.value));Z(async()=>{await L();var o=document.querySelector("#ai-chat");o.addEventListener("ai-chat-aiFirstAnswer",async a=>{setTimeout(async()=>{await L(),m.value=_.value[0].id,i("setChatTitle",_.value[0].name)},3e3)}),document.addEventListener("click",()=>{C.value=!1})});const Y=o=>{debugger;m.value=o.id;var a=document.querySelector("#ai-chat");a.switchChatSessions(o.id),I.setShowLink(!1),i("setChatTitle",o.name)},L=async()=>{const o=await d.getConversations(c.value);_.value=[...o.data],console.log(M.value)},tt=St.debounce(L,500),et=()=>{tt()},st=o=>{i("setShowHome",!1),Y(o)},j=()=>{m.value="",i("setChatTitle",""),i("setShowHome",!0),I.setShowLink(!1);var o=document.querySelector("#ai-chat");o&&o.newChat&&o.newChat()},ot=o=>{n.value=o.id,f.value=!0,l.value=o.name},nt=async()=>{f.value=!1,(await d.updateConversationName(n.value,l.value)).id===n.value&&(n.value="",l.value="",G.success("修改成功"),L())},at=o=>{V.confirm({title:"确认删除聊天记录?",content:"删除后，聊天记录不可恢复",okText:"确定",cancelText:"取消",onOk(){return d.deleteConversation(o).then(a=>{a.result==="success"&&(G.success("删除成功"),o===m.value&&(m.value="",j()),L())})},onCancel(){}})};return(o,a)=>{const K=vt,it=V,T=J;return p(),k("div",Pt,[r(bt),e("div",jt,[r(it,{visible:t(f),"onUpdate:visible":a[1]||(a[1]=w=>O(f)?f.value=w:null),title:"编辑对话名称","cancel-text":"取消","ok-text":"确认",onOk:nt},{default:R(()=>[r(K,{value:t(l),"onUpdate:value":a[0]||(a[0]=w=>O(l)?l.value=w:null),"show-count":"",maxlength:30},null,8,["value"])]),_:1},8,["visible"]),e("div",Kt,[$(e("div",{class:"new-chat",onClick:j},[r(T,{name:"newChat"}),a[5]||(a[5]=A(" 新建对话"))],512),[[H,!t(C)]]),r(K,{class:q(["search",{"in-search":t(C)}]),value:t(c),"onUpdate:value":a[2]||(a[2]=w=>O(c)?c.value=w:null),placeholder:"搜索历史对话记录",onChange:et,onClick:a[3]||(a[3]=B(()=>{},["stop"])),style:{height:"40px","border-radius":"8px"}},{prefix:R(()=>[$(e("div",{class:"search-mask",onClick:B(E,["stop"])},null,512),[[H,!t(C)]]),r(T,{name:"search",style:{width:"16px",height:"16px"}})]),_:1},8,["class","value"])]),e("div",zt,[(p(!0),k(U,null,z(Object.keys(t(M)),w=>(p(),k(U,{key:w},[t(M)[w].length!==0?(p(),k("div",Gt,x(t(At)[w]),1)):W("",!0),(p(!0),k(U,null,z(t(M)[w],g=>(p(),k("div",{key:g.id,class:q(["history-list-item",{"hisory-list-item-choosed":t(m)===g.id}]),onClick:D=>st(g),onMouseover:D=>S.value=g.id,onMouseleave:a[4]||(a[4]=D=>S.value="")},[r(T,{name:"chatList"}),e("div",Wt,x(g.name),1),$(e("div",Zt,[r(T,{name:"edit",onClick:B(D=>ot(g),["stop"])},null,8,["onClick"]),r(T,{name:"delete",onClick:B(D=>at(g.id),["stop"])},null,8,["onClick"])],512),[[H,t(S)===g.id||t(m)===g.id]])],42,Vt))),128))],64))),128))])])])}}},Qt=N(Jt,[["__scopeId","data-v-ee4e33af"]]),Xt={class:"chat"},Yt={class:"chat-main"},te={__name:"index",setup(v){const b=P(),u=Q(),h=s(!0),y=s(""),d=i=>{h.value=!1,y.value=i},c=i=>{h.value=i};return mt(()=>{b.setShowLink(!1)}),(i,S)=>(p(),k("div",Xt,[$(r(Qt,{onSetShowHome:c,onSetChatTitle:d},null,512),[[H,t(u).menuStatus]]),e("div",Yt,[r(Ft,{"show-home":t(h),onSetShowHome:c,chatTitle:t(y)},null,8,["show-home","chatTitle"])])]))}},He=N(te,[["__scopeId","data-v-77a227a7"]]);export{He as default};
