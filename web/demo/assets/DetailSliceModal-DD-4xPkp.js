import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as Z,b as ee,a0 as d,a5 as z,a2 as c,r as l,o as G,$ as k,a1 as f,c as p,u as t,F as E,a7 as F,G as j,a8 as W,H as B,a as te,a6 as ne,D as oe}from"./@vue-CaiV6rcx.js";import{g as ae,_ as se,T as le,B as ie,I as ue,F as re,a as H,M as ce,x as de,y as pe,z as _e,A as ve}from"./ant-design-vue-BAxZUW4F.js";import{h as m}from"./index-DmjgGXwh.js";import{V as R,Q as fe}from"./@ant-design-CcIJnn06.js";const me=Z({name:"SvgIcon",props:{prefix:{type:String,default:"icon"},name:{type:String,required:!0},color:{type:String,default:"#333"}},setup(e){return{symbolId:ee(()=>`#${e.prefix}-${e.name}`)}}}),ge={"aria-hidden":"true"},he=["href","fill"];function we(e,i,o,g,b,h){return d(),z("svg",ge,[c("use",{href:e.symbolId,fill:e.color},null,8,he)])}const Fe=Q(me,[["render",we],["__scopeId","data-v-75a038b6"]]);function je(){return m.request({method:"get",url:"/api/v1/knowledge/tree",params:{}})}function We(e){return m.request({method:"post",url:"/api/v1/knowledge/tree/node",data:e})}function Qe(e,i){return m.request({method:"put",url:`/api/v1/knowledge/tree/node/${e}`,data:i})}function Ve(e){return m.request({method:"delete",url:`/api/v1/knowledge/tree/node/${e}`})}function He(e,i){return m.request({method:"get",url:`/api/v1/knowledge/file/list/${e}`,params:i})}function Re(e){return m.request({method:"delete",url:"/api/v1/knowledge/file/delete",data:{ids:e}})}function Ae(e){return m.request({method:"post",url:"/api/v1/knowledge/file/parse/start",data:{document_ids:e}})}function Ge(e){return m.request({method:"post",url:"/api/v1/knowledge/file/parse/stop",data:{document_ids:e}})}function ye(e,i){return m.request({method:"get",url:`/api/v1/knowledge/file/chunks/${e}`,params:i})}function Je(e,i){return m.request({headers:{"Content-Type":"multipart/form-data"},method:"post",url:`/api/v1/knowledge/file/upload/${e}`,data:i})}function ke(e){return m.request({method:"get",url:`/api/preview/${e}`,params:{}})}function A(e,i,o){return m.request({method:"put",url:`/api/v1/knowledge/file/chunks/${e}/${i}`,data:{...o}})}const be={__name:"SliceEdit",props:{curSliceObj:{type:Object,default:null}},setup(e,{expose:i}){const o=l({}),g=l(""),b=l(!1),h=l(""),S=l(!1),y=e;G(()=>{const{content:_,important_keywords:v,questions:O}=y.curSliceObj;o.value={content:_,important_keywords:v,questions:O}});const C=()=>{b.value=!0},I=()=>{S.value=!0},M=_=>{o.value.important_keywords=[...o.value.important_keywords.filter(v=>v!==_)]},w=_=>{o.value.questions=[...o.value.questions.filter(v=>v!==_)]},n=()=>{b.value=!1,S.value=!1,g.value&&o.value.important_keywords.push(g.value),h.value&&o.value.questions.push(g.value),g.value="",h.value=""};return i({sliceData:o}),(_,v)=>{const O=ae,x=se,T=le,K=ie,U=ue,P=re;return d(),k(P,{ref:"formRef",layout:"vertical",name:"form_in_modal",style:{"margin-top":"10px"}},{default:f(()=>[p(x,{name:"",label:"解析块：:"},{default:f(()=>[p(O,{value:t(o).content,disabled:!0,rows:5},null,8,["value"])]),_:1}),p(x,{name:"",label:"关键词："},{default:f(()=>[(d(!0),z(E,null,F(t(o).important_keywords,r=>(d(),k(T,{closable:"",onClose:q=>M(r),key:r},{default:f(()=>[j(W(r),1)]),_:2},1032,["onClose"]))),128)),t(b)?(d(),k(U,{key:1,value:t(g),"onUpdate:value":v[0]||(v[0]=r=>B(g)?g.value=r:null),style:{"margin-top":"15px"},onBlur:n},null,8,["value"])):(d(),k(K,{key:0,class:"add-btn",onClick:C},{icon:f(()=>[p(t(R))]),_:1}))]),_:1}),p(x,{name:"",label:"问题："},{default:f(()=>[(d(!0),z(E,null,F(t(o).questions,r=>(d(),k(T,{closable:"",onClose:q=>w(r),key:r},{default:f(()=>[j(W(r),1)]),_:2},1032,["onClose"]))),128)),t(S)?(d(),k(U,{key:1,value:t(h),"onUpdate:value":v[1]||(v[1]=r=>B(h)?h.value=r:null),onBlur:n,style:{"margin-top":"15px"}},null,8,["value"])):(d(),k(K,{key:0,class:"add-btn",onClick:I,style:{"margin-top":"15px"}},{icon:f(()=>[p(t(R))]),_:1}))]),_:1})]),_:1},512)}}},Se=Q(be,[["__scopeId","data-v-3f99e723"]]),$e={class:"slice-main"},Ce={class:"pdf"},Oe=["src"],qe={class:"slice-content"},xe={class:"slice-list"},ze={class:"list-main beautify-scrollbar"},Ie={class:"slice-top"},Me={class:"seq"},Te={class:"operate-btn"},Ke=["onClick"],Ue=["innerHTML","onClick"],Be={__name:"DetailSliceModal",props:{modalOpen:{type:Boolean,default:!1},title:{type:String,default:""},documentId:{type:String,default:""},chunkPosition:{type:String,default:""}},emits:["update:modalOpen"],setup(e,{emit:i}){const o=l("1");l(6);const g=l(""),b=l([]),h=l(""),S=l(""),y=l(null),C=l(null),I=l(null),M=l(""),w=e,n=te({current:1,pageSize:10,total:50,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:a=>`共 ${a} 条`}),_=l(!1);G(async()=>{q();const a=await ke(w.documentId);S.value=a.previewUrl,h.value="/ai_center",M.value="/ai_center",y.value.contentWindow.postMessage({documentUrl:`${h.value}${S.value}`},"*"),w.chunkPosition&&y.value.contentWindow.postMessage({chunk:w.chunkPosition},"*")});const v=()=>{y.value.contentWindow.postMessage({documentUrl:`${h.value}${S.value}`},"*"),w.chunkPosition&&y.value.contentWindow.postMessage({chunk:w.chunkPosition},"*")},O=i,x=a=>{_.value=!0,C.value=a},T=async()=>{const a=I.value.sliceData;await A(w.documentId,C.value.id,{available:C.value.available,...a}),H.success("保存成功"),q(),_.value=!1},K=async a=>{const{content:s,important_keywords:$,questions:D}=a,L={content:s,important_keywords:$,questions:D};await A(w.documentId,a.id,{available:!a.available,...L}),q()},U=()=>{O("update:modalOpen",!1)},P=()=>{O("update:modalOpen",!1)},r=a=>{g.value=a.id;const s=a.positions;y.value.contentWindow.postMessage({chunk:JSON.stringify(s)},"*")},q=async(a={})=>{try{const s={page:n.current,pageSize:n.pageSize},$=await ye(w.documentId,s);n.total=$.data.total,b.value=$.data.chunks,console.log("Fetch data with params:",a)}catch{H.error("数据加载失败")}finally{}},J=()=>{q()};return(a,s)=>{const $=ce,D=de,L=pe,Y=_e,X=ve;return d(),k($,{style:{width:"100vw",top:0,paddingBottom:0,maxWidth:"auto",margin:"0px"},bodyStyle:{height:"calc(100vh - 55px)",overflowY:"auto",padding:"0px"},visible:e.modalOpen,title:e.title,"cancel-text":"取消","ok-text":"确认",onOk:U,onCancel:P,footer:null,destroyOnClose:!0},{default:f(()=>[p($,{visible:t(_),"onUpdate:visible":s[0]||(s[0]=u=>B(_)?_.value=u:null),title:"编辑解析块","cancel-text":"取消","ok-text":"保存",onOk:T,destroyOnClose:!0,style:{width:"40%"}},{default:f(()=>[p(Se,{curSliceObj:t(C),ref_key:"sliceEdit",ref:I},null,8,["curSliceObj"])]),_:1},8,["visible"]),c("div",$e,[c("div",Ce,[c("iframe",{src:`${t(M)}/pdf-view/index.html`,onLoad:v,ref_key:"iframe",ref:y,style:{width:"100%",height:"100%"}},null,40,Oe)]),c("div",qe,[p(X,{activeKey:t(o),"onUpdate:activeKey":s[3]||(s[3]=u=>B(o)?o.value=u:null)},{default:f(()=>[p(Y,{key:"1",tab:`段落（${t(n).total}）`},{default:f(()=>[c("div",xe,[c("div",ze,[(d(!0),z(E,null,F(t(b),(u,N)=>(d(),z("div",{class:ne(["list-item",{"choosed-slice":t(g)===u.id}]),key:u.id},[c("div",Ie,[c("div",Me,W((t(n).current-1)*t(n).pageSize+N+1<10?`0${N+1}`:(t(n).current-1)*t(n).pageSize+N+1)+". ",1),c("div",Te,[c("div",null,[p(D,{checked:u.available,onChange:V=>K(u)},null,8,["checked","onChange"])]),c("div",{onClick:oe(V=>x(u),["stop"]),class:"edit-btn"},[p(t(fe)),s[4]||(s[4]=j("编辑"))],8,Ke)])]),c("div",{class:"content",innerHTML:u.content,onClick:V=>r(u)},null,8,Ue)],2))),128))]),p(L,{current:t(n).current,"onUpdate:current":s[1]||(s[1]=u=>t(n).current=u),"page-size":t(n).pageSize,"onUpdate:pageSize":s[2]||(s[2]=u=>t(n).pageSize=u),total:t(n).total,"show-total":t(n).showTotal,showSizeChanger:t(n).showSizeChanger,pageSizeOptions:t(n).pageSizeOptions,onChange:J},null,8,["current","page-size","total","show-total","showSizeChanger","pageSizeOptions"])])]),_:1},8,["tab"])]),_:1},8,["activeKey"])])])]),_:1},8,["visible","title"])}}},Ye=Q(Be,[["__scopeId","data-v-ef4beafe"]]);export{Ye as D,Fe as _,We as a,Je as b,Re as c,Ve as d,He as e,Ae as f,je as g,Ge as s,Qe as u};
