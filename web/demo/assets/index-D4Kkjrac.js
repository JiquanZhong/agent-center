import{a as X,I as ye,M as j,c as we,d as fe,e as Ce}from"./ant-design-vue-CrukgR9D.js";import{_ as ke}from"./SvgIcon-DfibCmV0.js";import{a6 as _e,r as c,b as be,o as Se,a0 as v,a5 as k,v as S,B as x,u as t,a2 as o,c as n,a1 as p,H as Z,G as A,a7 as K,a8 as J,F as U,a9 as Q,aa as P,e as z,D as $,Z as xe,$ as ee,a4 as De,a3 as Re}from"./@vue-CWpNdP1s.js";import{_ as Ae}from"./index.vue_vue_type_style_index_0_scoped_a0c2022b_lang-BJDrWUBP.js";import{b as V,u as Te,c as Ne}from"./index-BVqB7X3U.js";import{l as qe}from"./lodash-BTFGF6yz.js";import{u as He,b as Fe}from"./vue-router-ue3rUI8W.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{J as te,K as Ie,N as se,O as Oe,Q as Ve}from"./@ant-design-DFXrkwDm.js";import"./@babel-Dd5QU_Ri.js";import"./lodash-es-CSO40SSR.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-bdfbxlhH.js";import"./vue-types-B67A5qzE.js";import"./@ctrl-3cdSgQbg.js";import"./dom-align-OCOKWGcj.js";import"./async-validator-P8scd9xB.js";import"./scroll-into-view-if-needed-BYx7v0DY.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./axios-upsvKRUO.js";import"./pinia-CkGp7EET.js";import"./vxe-pc-ui-DQu1CKTT.js";import"./xe-utils-BVyeMf_3.js";import"./@vxe-ui-Cq5EmHE1.js";import"./dom-zindex-DlWB42XF.js";import"./vxe-table-DW2_iyJ9.js";const Ke=""+new URL("logo-DkbGtkiM.png",import.meta.url).href,oe="data:image/png;base64,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";class Me{constructor(a){this.user=a}stopChatMessage(a){const i={url:`/v1/chat-messages/${a}/stop`,method:"post",data:JSON.stringify({user:this.user})};return V(i)}getConversations(a,i="",d=50){debugger;const m={url:"/v1/conversations",method:"get",params:{user:this.user,last_id:i,limit:d,keyWord:a}};return V(m)}deleteConversation(a){const i={url:`/v1/conversations/${a}`,method:"delete",data:{user:this.user}};return V(i)}updateConversationName(a,i="",d=!1){const m={url:`/v1/conversations/${a}/name`,method:"post",data:{name:i,auto_generate:d,user:this.user}};return V(m)}}const Le=H=>{const a=new Date;a.setHours(0,0,0,0);const i=new Date(a),d=new Date(a);d.setDate(a.getDate()-1);const m=new Date(a);m.setDate(a.getDate()-(a.getDay()+6)%7);const g=new Date(m);g.setDate(m.getDate()+6);const h={today:[],yesterday:[],thisWeek:[],earlier:[]};return H.forEach(l=>{const u=new Date(l.created_at*1e3);u.setHours(0,0,0,0),u.getTime()===i.getTime()?h.today.push(l):u.getTime()===d.getTime()?h.yesterday.push(l):u>=m&&u<=g?h.thisWeek.push(l):h.earlier.push(l)}),h},Ee={today:"今天",yesterday:"昨天",thisWeek:"本周",earlier:"更早"},Ze={class:"sidebar-menu"},Je={class:"sidebar-menu"},Ue={class:"logo"},Pe={class:"search"},ze={class:"history-list"},Ge={key:0,class:"categorize-title"},Ye=["onClick","onMouseover"],We={class:"history-list-item-title"},Be={class:"history-list-item-operating-button"},Xe={class:"hide-status-menu"},je={class:"hide-menu"},Qe={__name:"index",emits:["toggle","setChatTitle","setShowHome"],async setup(H,{emit:a}){let i,d;const m=([i,d]=_e(()=>Te().getCurrentUser()),i=await i,d(),i),{logout:g}=Ne(),h=new Me(m.id),l=c(""),u=c(!1),y=a,D=c(""),w=c(""),T=c([]),N=c(!1),F=c(""),R=c(""),M=He();Fe();const C=c(""),ne=c(""),_=c(!1),ie=s=>{s&&(C.value=s)},I=be(()=>Le(T.value));Se(async()=>{await q();var s=document.querySelector("#ai-chat");s.addEventListener("ai-chat-aiFirstAnswer",async e=>{setTimeout(async()=>{await q(),w.value=T.value[0].id,y("setChatTitle",T.value[0].name)},3e3)})});const G=s=>{C.value="",w.value=s.id,M.push({name:"chat"}),setTimeout(()=>{var e=document.querySelector("#ai-chat");e.switchChatSessions(s.id),y("setChatTitle",s.name)},300)},le=()=>{G(T.value[0])},L=()=>{w.value="",C.value="2",M.push({name:"knowledge"}),y("setShowHome",!0)},q=async()=>{const s=await h.getConversations(l.value);T.value=[...s.data],console.log(I.value)},re=qe.debounce(q,500),ue=()=>{re()},ce=s=>{y("setShowHome",!1),G(s)},E=()=>{w.value="",y("setChatTitle",""),y("setShowHome",!0),M.push({name:"chat"}),C.value="",ne.value="";var s=document.querySelector("#ai-chat");s&&s.newChat&&s.newChat()},Y=()=>{const s=document.getElementById("knowledge-table");y("toggle"),u.value?(s&&(s.style.width="calc(100vw - 620px)"),setTimeout(()=>{u.value=!u.value},150)):(u.value=!u.value,s&&(s.style.width="calc(100vw - 410px)"))},de=s=>{F.value=s.id,N.value=!0,R.value=s.name},me=async()=>{N.value=!1,(await h.updateConversationName(F.value,R.value)).id===F.value&&(F.value="",R.value="",X.success("修改成功"),q())},he=s=>{j.confirm({title:"确认删除聊天记录?",content:"删除后，聊天记录不可恢复",okText:"确定",cancelText:"取消",onOk(){return h.deleteConversation(s).then(e=>{e.result==="success"&&(X.success("删除成功"),s===w.value&&(w.value="",E()),q())})},onCancel(){}})};return(s,e)=>{const W=ye,pe=j,b=ke,ve=we,ge=fe,B=Ce;return v(),k("div",Ze,[S(o("div",Je,[n(pe,{visible:t(N),"onUpdate:visible":e[1]||(e[1]=r=>Z(N)?N.value=r:null),title:"编辑对话名称","cancel-text":"取消","ok-text":"确认",onOk:me},{default:p(()=>[n(W,{value:t(R),"onUpdate:value":e[0]||(e[0]=r=>Z(R)?R.value=r:null),"show-count":"",maxlength:30},null,8,["value"])]),_:1},8,["visible"]),o("div",Ue,[e[7]||(e[7]=o("img",{src:Ke,style:{width:"180px"}},null,-1)),n(b,{name:"sidebar",style:{width:"22px",height:"22px",cursor:"pointer"},onClick:Y})]),o("div",{class:"new-chat",onClick:E},[n(b,{name:"newChat",style:{width:"22px",height:"22px"}}),e[8]||(e[8]=A(" 新建对话"))]),n(ge,{activeKey:t(C),ghost:"",accordion:"",onChange:ie},{default:p(()=>[n(ve,{key:"2",showArrow:!1},{header:p(()=>[o("div",{class:K(["menu-item",{"menu-choosed":t(C)==="2"}]),onClick:L},[n(t(te)),e[9]||(e[9]=A(" 知识中心 "))],2)]),default:p(()=>[o("div",{class:K(["menu-item-sub-list",{"menu-item-sub-list-choosed":t(C)==="2"}])},[o("div",{onClick:L},[n(t(Ie)),e[10]||(e[10]=A("知识库管理"))])],2)]),_:1})]),_:1},8,["activeKey"]),o("div",{class:"history-main-child",style:J({height:t(_)?"calc(100vh - 380px)":"auto"})},[o("div",{class:"history-menu-item",onClick:e[2]||(e[2]=r=>_.value=!t(_))},[o("div",null,[n(t(se),{style:{position:"relative",bottom:"4px"}}),e[11]||(e[11]=A(" 历史会话"))]),S(n(t(Oe),null,null,512),[[x,!t(_)]]),e[12]||(e[12]=A()),S(n(t(Ve),null,null,512),[[x,t(_)]])]),S(o("div",Pe,[n(W,{value:t(l),"onUpdate:value":e[3]||(e[3]=r=>Z(l)?l.value=r:null),placeholder:"搜索历史记录",onChange:ue,style:{height:"40px","border-radius":"8px",width:"100%"}},{prefix:p(()=>[n(b,{name:"search",style:{width:"16px",height:"16px"}})]),_:1},8,["value"])],512),[[x,t(_)]]),S(o("div",ze,[(v(!0),k(U,null,Q(Object.keys(I.value),r=>(v(),k(U,{key:r},[I.value[r].length!==0?(v(),k("div",Ge,P(t(Ee)[r]),1)):z("",!0),(v(!0),k(U,null,Q(I.value[r],f=>(v(),k("div",{key:f.id,class:K(["history-list-item",{"hisory-list-item-choosed":t(w)===f.id}]),onClick:O=>ce(f),onMouseover:O=>D.value=f.id,onMouseleave:e[4]||(e[4]=O=>D.value="")},[o("div",We,P(f.name),1),S(o("div",Be,[n(b,{name:"edit",onClick:$(O=>de(f),["stop"])},null,8,["onClick"]),n(b,{name:"delete",onClick:$(O=>he(f.id),["stop"])},null,8,["onClick"])],512),[[x,t(D)===f.id||t(w)===f.id]])],42,Ye))),128))],64))),128))],512),[[x,t(_)]])],4),n(B,{title:"",trigger:"click",placement:"right"},{content:p(()=>[o("div",{class:"login-out",onClick:e[5]||(e[5]=(...r)=>t(g)&&t(g)(...r))},"注销")]),default:p(()=>[e[13]||(e[13]=o("div",{class:"sidebar-bottom"},[o("img",{src:oe}),A("用户信息")],-1))]),_:1})],512),[[x,!t(u)]]),S(o("div",Xe,[o("div",null,[e[14]||(e[14]=o("img",{src:Ae,style:{width:"30px",height:"30px"}},null,-1)),o("div",je,[n(b,{name:"sidebar",style:{width:"22px",height:"22px",cursor:"pointer"},onClick:Y}),n(b,{name:"newChat",style:{width:"22px",height:"22px"},onClick:E}),o("div",{style:J({color:t(C)==="2"?"#4180FF":"#909399"}),onClick:L},[n(t(te))],4),o("div",{onClick:le},[n(t(se),{style:J({color:t(w)?"#4180FF":"#909399"})},null,8,["style"])])])]),n(B,{title:"",trigger:"click",placement:"right"},{content:p(()=>[o("div",{class:"login-out",onClick:e[6]||(e[6]=(...r)=>t(g)&&t(g)(...r))},"注销")]),default:p(()=>[e[15]||(e[15]=o("div",{class:"hide-user",style:{cursor:"pointer"}},[o("img",{src:oe})],-1))]),_:1})],512),[[x,t(u)]])])}}},$e=ae(Qe,[["__scopeId","data-v-85c91c0a"]]),et={class:"ht-app"},tt={class:"main"},st={key:0,class:"main-header"},ot={class:"main-view"},at={__name:"index",setup(H){const a=c(!0),i=c(!1),d=c(""),m=()=>{i.value=!i.value},g=l=>{a.value=!1,d.value=l},h=l=>{a.value=l};return(l,u)=>{const y=xe("RouterView");return v(),k("div",et,[o("div",{class:K(["sidebar",{collapsed:t(i)}])},[n($e,{onToggle:m,onSetChatTitle:g,onSetShowHome:h})],2),o("div",tt,[t(a)?z("",!0):(v(),k("header",st,P(t(d)),1)),o("main",ot,[n(y,null,{default:p(({Component:D})=>[D?(v(),ee(Re,{key:0},{default:p(()=>[(v(),ee(De(D),{"show-home":t(a),onSetShowHome:h},null,40,["show-home"]))]),_:2},1024)):z("",!0)]),_:1})])])])}}},qt=ae(at,[["__scopeId","data-v-c31775b3"]]);export{qt as default};
