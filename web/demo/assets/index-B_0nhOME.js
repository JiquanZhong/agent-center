import{M as $,a as w,f as xe,I as ge,g as Ae,h as Oe,i as Ce,S as Ie,j as Se,_ as ye,k as Fe,m as Me,n as Ue,F as we,o as Le,p as be,q as Te,D as Ee,r as Re,U as Qe,B as Be,s as Ge,t as Pe,u as je,v as Ve,w as qe}from"./ant-design-vue-BAxZUW4F.js";import{g as Ye,d as Ze,a as Je,u as ze,_ as He,b as We,D as Xe,c as pe,e as $e,s as ce,f as me}from"./DetailSliceModal-DD-4xPkp.js";import{c as ke,C as et,a as tt,b as at}from"./index-DmjgGXwh.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r,o as he,a0 as g,a5 as H,c as a,a1 as n,a2 as i,G as c,u as t,H as Y,a8 as E,$ as K,e as A,ab as nt,w as fe,a as ve,k as lt,D as ot,a9 as st,Z as _e}from"./@vue-CaiV6rcx.js";import{O as it,Q as dt,T as ut}from"./@ant-design-CcIJnn06.js";import{d as re}from"./dayjs-bdfbxlhH.js";import"./@babel-Dd5QU_Ri.js";import"./lodash-es-CSO40SSR.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./vue-types-B67A5qzE.js";import"./@ctrl-3cdSgQbg.js";import"./dom-align-OCOKWGcj.js";import"./async-validator-P8scd9xB.js";import"./scroll-into-view-if-needed-BYx7v0DY.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./axios-upsvKRUO.js";import"./vue-router-OSjOocw4.js";import"./pinia-BeFrIkdG.js";import"./vxe-pc-ui-hfrMtXxV.js";import"./xe-utils-BVyeMf_3.js";import"./@vxe-ui-BUzpPuXs.js";import"./dom-zindex-DlWB42XF.js";import"./vxe-table-C39wX9VH.js";const rt={class:"tree-container"},pt={class:"form-main beautify-scrollbar"},ct={style:{"margin-top":"20px"}},mt={style:{"margin-top":"20px"}},ft={key:0,class:"cutting-method-describe"},vt={key:1,class:"cutting-method"},_t={class:"scheme-detail"},gt=["innerHTML"],yt=["title","onClick"],wt={class:"file-number"},bt={__name:"Tree",emits:["setSelectedTreeKey"],setup(R,{expose:I,emit:Q}){const N=r({general:{gs:"DOCX、EXCEL、PPT、IMAGE、PDF、TXT、MD、JSON、EML、HTML",gnsm:"系统使用视觉检测模型将连续文本分割成多个片段。这些片段被合并成 Token 数不超过预设值的块。",cj:"使用场景：适用于通用文档的分块处理。"},qa:{gs:"EXCEL、CSV/TXT",gnsm:"Excel 文件需包含两列（无标题），一列为问题，另一列为答案。<br/>CSV 或 TXT 文件需以 TAB 分隔问题和答案。<br/>每个问答对被视为一个独立的块。",cj:"适用于问答格式的文件。"},manual:{gs:"PDF",gnsm:"假设手册具有分层部分结构。<br/>使用最低部分标题作为切片的枢轴，确保同一部分中的图和表不会被分割。",cj:"适用于手册或分层结构的 PDF 文件。"},paper:{gs:"PDF",gnsm:"按论文的章节结构（如摘要、1.1、1.2 等）进行切片。<br/>有助于 LLM 更好地概括相关章节内容。",cj:"适用于学术论文的分块处理。"}}),f=r(0),m=r([]),v=r(!1),y=r(""),h=r(""),O=r(!1),b=r({}),_=r([]),p=r(!1),l=r({type:"general",delimiter:"",chunkTokenNum:1,autoKeywords:1,autoQuestions:1,autoSelect:"ai"}),T=Q,j=r(ke().isAdministrator());he(async()=>{await B();const o=ae(m.value);_.value=[o],T("setSelectedTreeKey",_.value[0])});const te=(o,e)=>{_.value[0]!==o[0]&&(_.value=o,T("setSelectedTreeKey",_.value[0]))},ae=o=>{let e=o[0];for(;e.children.length>0;)e=e.children[0];return e.id},B=async()=>{const o=await Ye();m.value=[o]},ne=o=>{b.value=o;debugger;if(o.menuKey)switch(o.menuKey){case"newNode":le();break;case"rename":S(o);break;case"delete":W();break}},le=o=>{O.value=!0,v.value=!0,f.value=0,y.value="",p.value=!1,l.value={type:"general",delimiter:"",chunkTokenNum:1,autoKeywords:1,autoQuestions:1,autoSelect:"ai"}},W=o=>{$.confirm({title:"确认删除该节点?",content:"删除后，节点不可恢复",okText:"确定",cancelText:"取消",onOk(){return Ze(b.value.id).then(()=>{w.success("删除成功"),B()})},onCancel(){}})},S=o=>{y.value=o.name,f.value=o.sortOrder,h.value=o.description,p.value=!0;debugger;l.value={...o},v.value=!0},F=async()=>{if(!y.value){w.warning("请输入节点名称");return}if(O.value){let o={};if(l.value.autoSelect==="ai"){const{autoKeywords:G,autoQuestions:k,autoSelect:V}=l.value;o={autoKeywords:G,autoQuestions:k,autoSelect:V}}else o={...l.value};const e={...o,pid:b.value.id,name:y.value,sortOrder:f.value||0,description:h.value,type:l.value.autoSelect==="ai"?b.value.type:l.value.type};debugger;await Je(e).catch(G=>{w.warning("节点名称存在重复，请重新输入")})&&(y.value="",B(),w.success("新增成功"),b.value={},v.value=!1,f.value=0)}else{const o={name:y.value,sortOrder:f.value,description:h.value};l.value={...b.value},await ze(b.value.id,o).catch(D=>{w.warning("节点名称存在重复，请重新输入")})&&(B(),w.success("修改成功"),b.value={},v.value=!1,f.value=0)}O.value=!1};return I({refreshTreeData:B}),(o,e)=>{const D=xe,G=ge,k=Ae,V=Oe,oe=Ce,q=Ie,se=Se,M=ye,d=Fe,s=Me,x=Ue,U=we,Z=He,C=Le,ie=$,P=be,de=Te,J=Ee,ue=Re;return g(),H("div",rt,[a(ie,{visible:t(v),"onUpdate:visible":e[12]||(e[12]=u=>Y(v)?v.value=u:null),title:t(O)?"新增节点":"修改节点","cancel-text":"取消","ok-text":"确认",onOk:F,onCancel:o.handleCancel,style:{padding:"0px",width:"40%",top:"6vh"},destroyOnClose:!0},{default:n(()=>[i("div",pt,[i("div",null,[e[13]||(e[13]=i("span",{class:"item-label"},[i("span",{style:{color:"red"}},"*"),c(" 顺序:")],-1)),i("div",null,[a(D,{id:"inputNumber",value:t(f),"onUpdate:value":e[0]||(e[0]=u=>Y(f)?f.value=u:null),min:0},null,8,["value"])])]),i("div",ct,[e[14]||(e[14]=i("span",{class:"item-label"},[i("span",{style:{color:"red"}},"*"),c("节点名称：")],-1)),a(G,{value:t(y),"onUpdate:value":e[1]||(e[1]=u=>Y(y)?y.value=u:null),placeholder:"请输入节点名称"},null,8,["value"])]),i("div",mt,[e[15]||(e[15]=i("span",{class:"item-label"},"节点描述:",-1)),a(k,{value:t(h),"onUpdate:value":e[2]||(e[2]=u=>Y(h)?h.value=u:null),placeholder:"请输入节点描述",rows:2},null,8,["value"])]),a(U,{ref:"formRef",model:t(l),layout:"vertical",name:"form_in_modal",style:{"margin-top":"10px"}},{default:n(()=>[a(M,{name:"autoSelect",label:"切图方式:"},{default:n(()=>[a(oe,{value:t(l).autoSelect,"onUpdate:value":e[3]||(e[3]=u=>t(l).autoSelect=u),"button-style":"solid",disabled:t(p)},{default:n(()=>[a(V,{value:"ai"},{default:n(()=>e[16]||(e[16]=[c("智能推荐")])),_:1}),a(V,{value:"custom"},{default:n(()=>e[17]||(e[17]=[c("自定义")])),_:1})]),_:1},8,["value","disabled"]),t(l).autoSelect==="ai"?(g(),H("div",ft," 系统根据上传文档类型和过往切片记录，自动选择合适的切片方案。 ")):(g(),H("div",vt,[e[25]||(e[25]=i("div",{class:"cutting-method-describe"},[c(" 可自定义切片方案，完全由对您不同类型的上传文档进行切片方案选择。"),i("span",{style:{color:"red"}},"需要对每种切片方案有一定了解！")],-1)),a(M,{name:"type",label:"切图方案："},{default:n(()=>[a(se,{ref:"select",value:t(l).type,"onUpdate:value":e[4]||(e[4]=u=>t(l).type=u),onFocus:o.focus,onChange:o.handleChange,disabled:t(p)},{default:n(()=>[a(q,{value:"general"},{default:n(()=>e[18]||(e[18]=[c("General")])),_:1}),a(q,{value:"qa"},{default:n(()=>e[19]||(e[19]=[c("Q&A")])),_:1}),a(q,{value:"manual"},{default:n(()=>e[20]||(e[20]=[c("Manual")])),_:1}),a(q,{value:"paper"},{default:n(()=>e[21]||(e[21]=[c("Paper")])),_:1})]),_:1},8,["value","onFocus","onChange","disabled"]),i("div",_t,[i("div",null,[e[22]||(e[22]=i("div",{class:"scheme-detail-label"},"适用文件格式：",-1)),i("p",null,E(t(N)[t(l).type].gs),1)]),i("div",null,[e[23]||(e[23]=i("div",{class:"scheme-detail-label"},"功能说明：",-1)),i("p",{innerHTML:t(N)[t(l).type].gnsm},null,8,gt)]),i("div",null,[e[24]||(e[24]=i("div",{class:"scheme-detail-label"},"使用场景：",-1)),i("p",null,E(t(N)[t(l).type].cj),1)])])]),_:1}),t(l).type==="general"?(g(),K(M,{key:0,name:"chunkTokenNum",label:"块Token数："},{default:n(()=>[a(x,null,{default:n(()=>[a(s,{span:18},{default:n(()=>[a(d,{id:"test",value:t(l).chunkTokenNum,"onUpdate:value":e[5]||(e[5]=u=>t(l).chunkTokenNum=u),min:1,max:2048,disabled:t(p)},null,8,["value","disabled"])]),_:1}),a(s,{span:6},{default:n(()=>[a(D,{value:t(l).chunkTokenNum,"onUpdate:value":e[6]||(e[6]=u=>t(l).chunkTokenNum=u),min:1,max:2048,style:{"margin-left":"16px"},disabled:t(p)},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})):A("",!0),t(l).type==="general"?(g(),K(M,{key:1,name:"delimiter",label:"分段标识符："},{default:n(()=>[a(G,{value:t(l).delimiter,"onUpdate:value":e[7]||(e[7]=u=>t(l).delimiter=u),disabled:t(p)},null,8,["value","disabled"])]),_:1})):A("",!0)]))]),_:1})]),_:1},8,["model"])]),a(U,{ref:"formRef",model:t(l),layout:"inline",name:"form_in_modal",style:{"margin-top":"10px"},labelAlign:"right",labelCol:{style:{width:"80px"}}},{default:n(()=>[a(M,{name:"自动关键词：",label:"自动关键词：",style:{width:"100%","margin-top":"20px"}},{default:n(()=>[a(x,null,{default:n(()=>[a(s,{span:15},{default:n(()=>[a(d,{id:"test",value:t(l).autoKeywords,"onUpdate:value":e[8]||(e[8]=u=>t(l).autoKeywords=u),min:1,max:30,disabled:t(p)},null,8,["value","disabled"])]),_:1}),a(s,{span:6},{default:n(()=>[a(D,{value:t(l).autoKeywords,"onUpdate:value":e[9]||(e[9]=u=>t(l).autoKeywords=u),min:1,max:30,style:{"margin-left":"16px"},disabled:t(p)},null,8,["value","disabled"])]),_:1}),a(s,{span:3},{default:n(()=>[a(C,{placement:"top",arrow:o.mergedArrow},{title:n(()=>e[26]||(e[26]=[i("span",null,"自动关键词不超过30个",-1)])),default:n(()=>[a(Z,{name:"tip",style:{width:"16px",height:"16px"},class:"tip"})]),_:1},8,["arrow"])]),_:1})]),_:1})]),_:1}),a(M,{name:"自动问题：",label:"自动问题：",style:{width:"100%","margin-top":"20px"}},{default:n(()=>[a(x,null,{default:n(()=>[a(s,{span:15},{default:n(()=>[a(d,{id:"test",value:t(l).autoQuestions,"onUpdate:value":e[10]||(e[10]=u=>t(l).autoQuestions=u),min:1,max:10,disabled:t(p)},null,8,["value","disabled"])]),_:1}),a(s,{span:6},{default:n(()=>[a(D,{value:t(l).autoQuestions,"onUpdate:value":e[11]||(e[11]=u=>t(l).autoQuestions=u),min:1,max:10,style:{"margin-left":"16px"},disabled:t(p)},null,8,["value","disabled"])]),_:1}),a(s,{span:3},{default:n(()=>[a(C,{placement:"top",arrow:o.mergedArrow},{title:n(()=>e[27]||(e[27]=[i("span",null,"自动问题不超过10个",-1)])),default:n(()=>[a(Z,{name:"tip",style:{width:"16px",height:"16px"},class:"tip"})]),_:1},8,["arrow"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","onCancel"]),t(m).length?(g(),K(ue,{key:0,"tree-data":t(m),blockNode:!0,virtual:!1,fieldNames:{children:"children",title:"name",key:"id"},defaultExpandAll:!0,selectedKeys:t(_)},{title:n(u=>[a(J,{trigger:["contextmenu"]},nt({default:n(()=>[i("span",{class:"node-content",title:u.description||u.name,onClick:X=>te([u.data.id])},[o.children&&o.children.length!==0?(g(),K(Z,{key:0,name:"wjj",style:{width:"15px",height:"15px",display:"inline-block",position:"relative",bottom:"2px"}})):A("",!0),c(" "+E(u.name)+" ",1),i("span",wt,"（"+E(u.data.documentNum)+"）",1)],8,yt)]),_:2},[t(j)?{name:"overlay",fn:n(()=>[a(de,{onClick:({key:X})=>ne({...u.data,menuKey:X})},{default:n(()=>[a(P,{key:"newNode"},{icon:n(()=>[a(t(it))]),default:n(()=>[e[28]||(e[28]=c(" 新建节点 "))]),_:1}),a(P,{key:"rename"},{icon:n(()=>[a(t(dt))]),default:n(()=>[e[29]||(e[29]=c(" 修改 "))]),_:1}),a(P,{key:"delete",danger:""},{icon:n(()=>[a(t(ut))]),default:n(()=>[e[30]||(e[30]=c(" 删除 "))]),_:1})]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)]),_:1},8,["tree-data","selectedKeys"])):A("",!0)])}}},Tt=ee(bt,[["__scopeId","data-v-7d3a558a"]]),kt="data:image/png;base64,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",ht={class:"upload-actions"},Nt={class:"tip"},Dt={__name:"UpLoadFileModal",props:{modalOpen:{type:Boolean,default:!1},selectedTreeKey:{type:String,default:""}},emits:["update:modalOpen","upload-success"],setup(R,{emit:I}){tt().get(et.TOKEN_NAME);const N=R,f=I,m=r([]),v=r(!1),y=_=>{const p=["doc","docx","pdf","ppt","txt"],l=_.type.startsWith("image/"),T=_.name.split(".").pop().toLowerCase();return!p.includes(T)&&!l?(w.error("仅支持上传文档（doc/docx/pdf/ppt/txt）或图片文件"),!1):(m.value=[...m.value,_],!1)},h=async()=>{var p,l;if(m.value.length===0)return;v.value=!0;const _=new FormData;m.value.forEach(T=>{_.append("files",T.originFileObj)});try{await We(N.selectedTreeKey,_),w.success("上传成功"),m.value=[],O()}catch(T){w.error("上传失败: "+(((l=(p=T.response)==null?void 0:p.data)==null?void 0:l.message)||T.message))}finally{uploading.value=!1}},O=()=>{v.value=!1,f("update:modalOpen",!1)},b=()=>{f("update:modalOpen",!1)};return(_,p)=>{const l=Qe,T=$;return g(),K(T,{style:{width:"50%"},visible:R.modalOpen,title:"上传文档","cancel-text":"取消","confirm-loading":v.value,destroyOnClose:!0,"ok-text":"开始上传",onOk:h,onCancel:b},{default:n(()=>[a(l,{fileList:m.value,"onUpdate:fileList":p[0]||(p[0]=j=>m.value=j),name:"files",multiple:!0,accept:".doc,.docx,.pdf,.ppt,.txt,image/*","before-upload":y,onChange:_.handleChange,onDrop:_.handleDrop,showUploadList:{showRemoveIcon:!v.value}},{default:n(()=>p[1]||(p[1]=[i("div",{class:"ant-upload-drag-icon"},[i("img",{src:kt}),i("p",{style:{color:"#4687fe","font-weight":"600"}},"上传本地文件")],-1)])),_:1},8,["fileList","onChange","onDrop","showUploadList"]),i("div",ht,[i("span",Nt,"已选择 "+E(m.value.length)+" 个文件",1)])]),_:1},8,["visible","confirm-loading"])}}},Kt=ee(Dt,[["__scopeId","data-v-cae81bf8"]]),xt={class:"knowledge-table-container"},At={class:"main-content"},Ot={class:"search-section"},Ct={class:"table-section"},It={__name:"KnowledgeTable",props:{selectedTreeKey:{type:String,required:!0}},emits:["refreshTreeData"],setup(R,{emit:I}){const Q=at(),N=r(ke().isAdministrator()),f=r([]);r(!1);const m=r(!1),v=r(!1),y=r(""),h=r("开始解析"),O=r(""),b=I;let _=null;const p={UNSTART:"待解析",RUNNING:"解析中",CANCEL:"已取消",DONE:"已入库",FAIL:"入库失败"},l={UNSTART:"开始解析",RUNNING:"停止解析",CANCEL:"重新解析",DONE:"查看",FAIL:"重新解析"},T={UNSTART:"",RUNNING:"",CANCEL:"",DONE:"#389e0d",FAIL:"#ff4d4f"},j=R,te=()=>{m.value=!0},ae=d=>{h.value=d.key};fe(()=>j.selectedTreeKey,d=>{Object.assign(S,{name:""}),D.value=!1,F.current=1,k()}),fe(()=>m.value,d=>{d||(k(),b("refreshTreeData"))});const B=d=>{$.confirm({title:"确认删除该文件?",content:"删除后，文件不可恢复",okText:"确定",cancelText:"取消",onOk(){return pe([d.id]).then(s=>{w.success("删除成功"),k(),b("refreshTreeData")})},onCancel(){}})},ne=[{title:"文档名称",dataIndex:"name",ellipsis:!0},{title:"上传人",dataIndex:"username",width:80,ellipsis:!0},{title:"上传时间",dataIndex:"create_time",width:100,sorter:(d,s)=>re(d.createTime)-re(s.createTime),customRender:({text:d})=>re(Number(d)).format("YYYY-MM-DD HH:mm:ss")},{title:"文档状态",dataIndex:"run",width:80,align:"center"},{title:"文档类型",dataIndex:"type",width:80,align:"center"},{title:"操作",dataIndex:"operation",width:150,align:"center",fixed:"right"}],le=d=>{Object.assign(F,d),k()},W=r([]),S=ve({name:""}),F=ve({current:1,pageSize:10,total:50,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:d=>`共 ${d} 条`}),o=r(!1),e=r(!1),D=r(!1);he(()=>{}),lt(()=>{clearInterval(_)});const G=d=>{f.value=d},k=async d=>{try{d||(o.value=!0);const s={...S,page:F.current,pageSize:F.pageSize},x=await $e(j.selectedTreeKey,s);F.total=x.data.total,W.value=x.data.docs}catch{w.error("数据加载失败")}finally{o.value=!1}},V=()=>{D.value=!0,k()},oe=()=>{Object.assign(S,{name:""}),D.value=!1,k()},q=d=>{v.value=!0,y.value=d.name,O.value=d.id},se=async()=>{const d=f.value;switch(h.value){case"开始解析":await me(d),w.success("已批量开始解析");break;case"结束解析":await ce(d),w.success("已批量结束解析");break;default:pe(d).then(s=>{w.success("批量删除成功")})}f.value=[],k()},M=async d=>{const s=["UNSTART","CANCEL","FAIL"],x=["RUNNING"],U=d.run;s.includes(U)?(await me([d.id]),k()):x.includes(U)?(await ce([d.id]),k()):q(d)};return(d,s)=>{const x=ge,U=ye,Z=_e("SearchOutlined"),C=Be,ie=_e("UndoOutlined"),P=Ge,de=we,J=be,ue=Te,u=Pe,X=je,Ne=Ve,De=qe;return g(),H("div",xt,[a(Kt,{modalOpen:t(m),"onUpdate:modalOpen":s[0]||(s[0]=L=>Y(m)?m.value=L:null),selectedTreeKey:R.selectedTreeKey},null,8,["modalOpen","selectedTreeKey"]),t(v)?(g(),K(Xe,{key:0,modalOpen:t(v),"onUpdate:modalOpen":s[1]||(s[1]=L=>Y(v)?v.value=L:null),title:t(y),documentId:t(O)},null,8,["modalOpen","title","documentId"])):A("",!0),i("div",At,[i("div",Ot,[a(de,{model:t(S),layout:"inline",class:"advanced-search-form",onSubmit:ot(V,["prevent"])},{default:n(()=>[a(U,{label:"文档名称",class:"form-item-custom"},{default:n(()=>[a(x,{value:t(S).name,"onUpdate:value":s[2]||(s[2]=L=>t(S).name=L),placeholder:"请输入关键字进行搜索",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1}),a(U,{class:"form-item-custom"},{default:n(()=>[a(P,{size:16},{default:n(()=>[a(C,{"html-type":"submit",loading:t(e),type:"primary"},{icon:n(()=>[a(Z)]),default:n(()=>[s[3]||(s[3]=c(" 搜索 "))]),_:1},8,["loading"]),a(C,{onClick:oe,class:"main-btn"},{icon:n(()=>[a(ie)]),default:n(()=>[s[4]||(s[4]=c(" 重置 "))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",Ct,[a(P,{size:16,style:{"margin-bottom":"20px"}},{default:n(()=>[t(N)?(g(),K(C,{key:0,type:"primary",onClick:te},{default:n(()=>s[5]||(s[5]=[c(" 上传文档 ")])),_:1})):A("",!0),a(u,{onClick:se,type:"primary"},{overlay:n(()=>[a(ue,{onClick:ae},{default:n(()=>[a(J,{key:"开始解析"},{default:n(()=>s[6]||(s[6]=[c(" 开始解析 ")])),_:1}),a(J,{key:"结束解析"},{default:n(()=>s[7]||(s[7]=[c(" 结束解析 ")])),_:1}),a(J,{key:"删除"},{default:n(()=>s[8]||(s[8]=[c("删除")])),_:1})]),_:1})]),default:n(()=>[c(E(t(h))+" ",1)]),_:1})]),_:1}),a(De,{"row-selection":{selectedRowKeys:t(f),onChange:G},columns:ne,loading:t(o),"data-source":t(W),pagination:t(F),scroll:{x:500,y:t(Q).gjMode?"calc(100vh - 82px - 320px)":"calc(100vh - 320px)"},bordered:"",size:"middle","row-key":"id",sticky:"",onChange:le},{bodyCell:n(({column:L,record:z})=>[L.dataIndex==="run"?(g(),K(C,{key:0,type:"link",size:"small",style:st({color:T[z.run]})},{default:n(()=>[c(E(p[z.run]),1)]),_:2},1032,["style"])):A("",!0),L.dataIndex==="operation"?(g(),K(P,{key:1,size:4},{default:n(()=>[a(C,{type:"link",size:"small",onClick:Ke=>M(z)},{default:n(()=>[c(E(l[z.run]),1)]),_:2},1032,["onClick"]),t(N)?(g(),K(X,{key:0,type:"vertical"})):A("",!0),t(N)?(g(),K(C,{key:1,type:"link",size:"small",style:{color:"#ea3333"},onClick:Ke=>B(z)},{default:n(()=>s[9]||(s[9]=[c(" 删除 ")])),_:2},1032,["onClick"])):A("",!0)]),_:2},1024)):A("",!0)]),emptyText:n(()=>[a(Ne,{description:t(D)?"暂无相关数据":"暂无数据"},null,8,["description"])]),_:1},8,["row-selection","loading","data-source","pagination","scroll"])])])])}}},St=ee(It,[["__scopeId","data-v-a3e28548"]]),Ft={class:"knowledge"},Mt={class:"tree"},Ut={id:"knowledge-table"},Lt={__name:"index",setup(R){const I=r(null),Q=r(""),N=m=>{Q.value=m},f=()=>{I.value.refreshTreeData()};return(m,v)=>(g(),H("div",Ft,[i("div",Mt,[a(Tt,{onSetSelectedTreeKey:N,ref_key:"tree",ref:I},null,512)]),i("div",Ut,[a(St,{selectedTreeKey:t(Q),onRefreshTreeData:f},null,8,["selectedTreeKey"])])]))}},ia=ee(Lt,[["__scopeId","data-v-37f4e3a7"]]);export{ia as default};
