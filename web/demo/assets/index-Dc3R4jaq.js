import{r as o,w as re,a0 as y,a5 as w,u as e,$ as le,H as O,e as J,a2 as t,a8 as T,c as v,a1 as R,G as F,o as V,a6 as N,v as D,B as L,a9 as ce,F as B,Z as ue,aa as de,b as he,D as q,a7 as K,k as me}from"./@vue-CaiV6rcx.js";import{_ as ve}from"./logo-hide-Cfo-5b6o.js";import{B as pe,a as z,M as G,I as _e}from"./ant-design-vue-BAxZUW4F.js";import{D as fe,_ as Z}from"./DetailSliceModal-DD-4xPkp.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as Q,C as ye,u as X,a as ke,d as E}from"./index-DmjgGXwh.js";import{d as we}from"./pinia-BeFrIkdG.js";import{l as ge}from"./lodash-BTFGF6yz.js";import{u as Ce,b as Se}from"./vue-router-OSjOocw4.js";import{_ as be}from"./LogoHeader-DzAU8wjq.js";import"./@babel-Dd5QU_Ri.js";import"./@ant-design-CcIJnn06.js";import"./@ctrl-3cdSgQbg.js";import"./lodash-es-CSO40SSR.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-bdfbxlhH.js";import"./vue-types-B67A5qzE.js";import"./dom-align-OCOKWGcj.js";import"./async-validator-P8scd9xB.js";import"./scroll-into-view-if-needed-BYx7v0DY.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./axios-upsvKRUO.js";import"./vxe-pc-ui-hfrMtXxV.js";import"./xe-utils-BVyeMf_3.js";import"./@vxe-ui-BUzpPuXs.js";import"./dom-zindex-DlWB42XF.js";import"./vxe-table-C39wX9VH.js";const Te={class:"link-content"},xe={class:"link-list"},$e={class:"link-list-item"},De={class:"item-content beautify-scrollbar"},Le={class:"item-file-link"},He={class:"file-name"},Ie={__name:"linkContent",props:{chunk:{type:Object,default:()=>{}}},emits:"closeLink",setup(p,{emit:s}){o("8"),o(null),o("");const r=o(""),l=o(""),c=o(""),h=o(!1),a=o(""),n=o(""),m=p,u=s,_=()=>{u("closeLink")},g=()=>{h.value=!0};return re(()=>m.chunk,k=>{r.value=k.preview_url,a.value=k.positions,l.value=k.document_Keyword,c.value=k.document_id,n.value=k.content}),(k,f)=>{const b=Z,H=pe;return y(),w("div",Te,[e(h)?(y(),le(fe,{key:0,modalOpen:e(h),"onUpdate:modalOpen":f[0]||(f[0]=P=>O(h)?h.value=P:null),title:e(l),documentId:e(c),chunkPosition:e(a)},null,8,["modalOpen","title","documentId","chunkPosition"])):J("",!0),t("div",{class:"header"},[f[1]||(f[1]=t("div",{class:"title"},[t("h3",null,"引用资料")],-1)),t("div",{class:"close-btn",onClick:_},"✕")]),t("div",xe,[t("div",$e,[t("div",De,T(e(n)),1),t("div",Le,[t("div",null,[v(b,{name:"pdf",style:{width:"25px",height:"25px"}})]),t("div",He,[t("div",null,T(e(l)),1)]),t("div",null,[v(H,{style:{background:"#4180ff","border-radius":"5px",color:"white"},onClick:g},{default:R(()=>f[2]||(f[2]=[F("阅读原文")])),_:1})])])])])])}}},Me=U(Ie,[["__scopeId","data-v-2a501594"]]),A=we("chat",{state:()=>({showLink:!1}),getters:{},actions:{setShowLink(p){this.showLink=p}}}),qe={key:0,class:"chat-home-page"},Ee={class:"main"},Oe={class:"logo"},Be={key:1,class:"main-header"},Ne={__name:"chat",props:{showHome:{type:Boolean,default:!0},chatTitle:{type:String,default:""}},emits:["setShowHome"],setup(p,{emit:s}){const r=Q(),l=ke(),c=o(null),h=s,a=A();V(()=>{n()});const n=async()=>{const m=l.get(ye.TOKEN_NAME),u=await X().getCurrentUser();try{window.DiitAiChat.register("ai-chat","/ai_center/lib/chatTheme.css")}catch{var _=document.querySelector("#ai-chat")}finally{var _=document.querySelector("#ai-chat")}_.chatConfig={mode:"complex",loading:"progress",deepTinkType:window.houtuServeConfig.deepTinkType,brand:{logo:"",title:"",isShow:!1},deepThinkBtn:{...window.houtuServeConfig.chatDeepThinkBtn},knowledgeBtn:{defaultStatus:!0,isShow:!0},robot:{avatar:"./img/robot.png"},user:{avatar:""},systemFirstComponent:"",messages:[{code:"system",data:{text:""}},{code:"robot",data:{text:""}}],placeholder:"",sidebar:{customComponent:null},bottomTip:"",apiConfig:{url:"/ai_center",apiKey:m,user:u.id}},_.newChat(),_.addEventListener("ai-chat-sendFirstChat",()=>{h("setShowHome",!1)}),_.addEventListener("ai-chat-clickSubscript",g=>{c.value=g.detail[0],a.setShowLink(!0)})};return(m,u)=>{const _=ue("ai-chat");return y(),w(B,null,[p.showHome?(y(),w("div",qe,[t("div",Ee,[t("div",Oe,[u[1]||(u[1]=t("img",{src:ve},null,-1)),F(" "+T(e(r).gjMode?" 自然资源行业“后土”大模型":"国土空间基础信息平台 | 后土应用"),1)]),u[2]||(u[2]=t("div",{class:"describe"},"集智于一脑，汇能于一体，服务治理自然资源新篇章",-1))])])):(y(),w("header",Be,T(p.chatTitle),1)),t("div",{class:"chat-main",style:ce({height:p.showHome?"auto":""})},[v(_,{id:"ai-chat",class:N({"home-page":p.showHome}),style:{width:"100%"}},null,8,["class"]),D(v(Me,{onCloseLink:u[0]||(u[0]=g=>e(a).setShowLink(!1)),chunk:e(c)},null,8,["chunk"]),[[L,e(a).showLink&&!p.showHome]])],4),t("div",{class:N(["bottom-tip",{"bottom-tip-shrink":e(a).showLink}])}," 服务生成的所有内容均由人工智能模型生成，其生成内容的准确性和完整性无法保证，请注意甄别 ",2)],64)}}},Ue=U(Ne,[["__scopeId","data-v-95fb5b79"]]);class Pe{constructor(s){this.user=s}stopChatMessage(s){const r={url:`/v1/chat-messages/${s}/stop`,method:"post",data:JSON.stringify({user:this.user})};return E(r)}getConversations(s,r="",l=50){const c={url:"/v1/conversations",method:"get",params:{user:this.user,last_id:r,limit:l,keyWord:s}};return E(c)}deleteConversation(s){const r={url:`/v1/conversations/${s}`,method:"delete",data:{user:this.user}};return E(r)}updateConversationName(s,r="",l=!1){const c={url:`/v1/conversations/${s}/name`,method:"post",data:{name:r,auto_generate:l,user:this.user}};return E(c)}}const Re=p=>{const s=new Date;s.setHours(0,0,0,0);const r=new Date(s),l=new Date(s);l.setDate(s.getDate()-1);const c=new Date(s);c.setDate(s.getDate()-(s.getDay()+6)%7);const h=new Date(c);h.setDate(c.getDate()+6);const a={today:[],yesterday:[],thisWeek:[],earlier:[]};return p.forEach(n=>{const m=new Date(n.created_at*1e3);m.setHours(0,0,0,0),m.getTime()===r.getTime()?a.today.push(n):m.getTime()===l.getTime()?a.yesterday.push(n):m>=c&&m<=h?a.thisWeek.push(n):a.earlier.push(n)}),a},Fe={today:"今天",yesterday:"昨天",thisWeek:"本周",earlier:"更早"},Ae={class:"chat-history"},We={class:"history-main"},je={class:"history-top"},Ke={class:"history-list"},ze={key:0,class:"categorize-title"},Ge=["onClick","onMouseover"],Je={class:"history-list-item-title"},Ve={class:"history-list-item-operating-button"},Ze={__name:"historyList",emits:["toggle","setChatTitle","setShowHome"],async setup(p,{emit:s}){let r,l;const c=([r,l]=de(()=>X().getCurrentUser()),r=await r,l(),r),h=new Pe(c.id),a=o("");o(!1);const n=s,m=o(""),u=o(""),_=o([]),g=o(!1),k=o(""),f=o("");Ce(),Se(),o(""),o(""),o(!1);const b=o(!1),H=A(),P=()=>{b.value=!0},I=he(()=>Re(_.value));V(async()=>{await x();var i=document.querySelector("#ai-chat");i.addEventListener("ai-chat-aiFirstAnswer",async d=>{setTimeout(async()=>{await x(),u.value=_.value[0].id,n("setChatTitle",_.value[0].name)},3e3)}),document.addEventListener("click",()=>{b.value=!1})});const Y=i=>{debugger;u.value=i.id;var d=document.querySelector("#ai-chat");d.switchChatSessions(i.id),H.setShowLink(!1),n("setChatTitle",i.name)},x=async()=>{const i=await h.getConversations(a.value);_.value=[...i.data],console.log(I.value)},ee=ge.debounce(x,500),te=()=>{ee()},se=i=>{n("setShowHome",!1),Y(i)},W=()=>{u.value="",n("setChatTitle",""),n("setShowHome",!0),H.setShowLink(!1);var i=document.querySelector("#ai-chat");i&&i.newChat&&i.newChat()},oe=i=>{k.value=i.id,g.value=!0,f.value=i.name},ae=async()=>{g.value=!1,(await h.updateConversationName(k.value,f.value)).id===k.value&&(k.value="",f.value="",z.success("修改成功"),x())},ne=i=>{G.confirm({title:"确认删除聊天记录?",content:"删除后，聊天记录不可恢复",okText:"确定",cancelText:"取消",onOk(){return h.deleteConversation(i).then(d=>{d.result==="success"&&(z.success("删除成功"),i===u.value&&(u.value="",W()),x())})},onCancel(){}})};return(i,d)=>{const j=_e,ie=G,$=Z;return y(),w("div",Ae,[v(be),t("div",We,[v(ie,{visible:e(g),"onUpdate:visible":d[1]||(d[1]=C=>O(g)?g.value=C:null),title:"编辑对话名称","cancel-text":"取消","ok-text":"确认",onOk:ae},{default:R(()=>[v(j,{value:e(f),"onUpdate:value":d[0]||(d[0]=C=>O(f)?f.value=C:null),"show-count":"",maxlength:30},null,8,["value"])]),_:1},8,["visible"]),t("div",je,[D(t("div",{class:"new-chat",onClick:W},[v($,{name:"newChat"}),d[5]||(d[5]=F(" 新建对话"))],512),[[L,!e(b)]]),v(j,{class:N(["search",{"in-search":e(b)}]),value:e(a),"onUpdate:value":d[2]||(d[2]=C=>O(a)?a.value=C:null),placeholder:"搜索历史对话记录",onChange:te,onClick:d[3]||(d[3]=q(()=>{},["stop"])),style:{height:"40px","border-radius":"8px"}},{prefix:R(()=>[D(t("div",{class:"search-mask",onClick:q(P,["stop"])},null,512),[[L,!e(b)]]),v($,{name:"search",style:{width:"16px",height:"16px"}})]),_:1},8,["class","value"])]),t("div",Ke,[(y(!0),w(B,null,K(Object.keys(e(I)),C=>(y(),w(B,{key:C},[e(I)[C].length!==0?(y(),w("div",ze,T(e(Fe)[C]),1)):J("",!0),(y(!0),w(B,null,K(e(I)[C],S=>(y(),w("div",{key:S.id,class:N(["history-list-item",{"hisory-list-item-choosed":e(u)===S.id}]),onClick:M=>se(S),onMouseover:M=>m.value=S.id,onMouseleave:d[4]||(d[4]=M=>m.value="")},[v($,{name:"chatList"}),t("div",Je,T(S.name),1),D(t("div",Ve,[v($,{name:"edit",onClick:q(M=>oe(S),["stop"])},null,8,["onClick"]),v($,{name:"delete",onClick:q(M=>ne(S.id),["stop"])},null,8,["onClick"])],512),[[L,e(m)===S.id||e(u)===S.id]])],42,Ge))),128))],64))),128))])])])}}},Qe=U(Ze,[["__scopeId","data-v-ee4e33af"]]),Xe={class:"chat"},Ye={class:"chat-main"},et={__name:"index",setup(p){const s=A(),r=Q(),l=o(!0),c=o(""),h=n=>{l.value=!1,c.value=n},a=n=>{l.value=n};return me(()=>{s.setShowLink(!1)}),(n,m)=>(y(),w("div",Xe,[D(v(Qe,{onSetShowHome:a,onSetChatTitle:h},null,512),[[L,e(r).menuStatus]]),t("div",Ye,[v(Ue,{"show-home":e(l),onSetShowHome:a,chatTitle:e(c)},null,8,["show-home","chatTitle"])])]))}},Dt=U(et,[["__scopeId","data-v-77a227a7"]]);export{Dt as default};
