import{M as j,a as O,f as Oe,I as pe,g as Ke,h as me,i as fe,D as Ne,j as Ae,U as xe,k as Ie,m as Se,T as Ce,_ as De,B as Fe,n as Ue,F as Me,o as Le,p as qe,q as Re,r as Ee}from"./ant-design-vue-CrukgR9D.js";import{_ as ve}from"./SvgIcon-DfibCmV0.js";import{h as S,c as ge,C as ze,a as Be}from"./index-BVqB7X3U.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r,o as le,a0 as T,a5 as J,c as o,a1 as a,a2 as d,G as y,u as e,H as Q,$ as D,ab as Pe,e as E,aa as z,a as se,F as Ge,a9 as Qe,a7 as Ve,w as ie,k as Ye,D as Ze,a8 as je,Z as re}from"./@vue-CWpNdP1s.js";import{T as Je,V as We,W as He}from"./@ant-design-DFXrkwDm.js";import{d as oe}from"./dayjs-bdfbxlhH.js";import"./@babel-Dd5QU_Ri.js";import"./lodash-es-CSO40SSR.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./vue-types-B67A5qzE.js";import"./@ctrl-3cdSgQbg.js";import"./dom-align-OCOKWGcj.js";import"./async-validator-P8scd9xB.js";import"./scroll-into-view-if-needed-BYx7v0DY.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./axios-upsvKRUO.js";import"./vue-router-ue3rUI8W.js";import"./pinia-CkGp7EET.js";import"./vxe-pc-ui-DQu1CKTT.js";import"./xe-utils-BVyeMf_3.js";import"./@vxe-ui-Cq5EmHE1.js";import"./dom-zindex-DlWB42XF.js";import"./vxe-table-DW2_iyJ9.js";function Xe(){return S.request({method:"get",url:"/api/v1/knowledge/tree",params:{}})}function $e(i){return S.request({method:"post",url:"/api/v1/knowledge/tree/node",data:i})}function et(i,p){return S.request({method:"put",url:`/api/v1/knowledge/tree/node/${i}`,data:p})}function tt(i){return S.request({method:"delete",url:`/api/v1/knowledge/tree/node/${i}`})}function nt(i,p){return S.request({method:"get",url:`/api/v1/knowledge/file/list/${i}`,params:p})}function de(i){return S.request({method:"delete",url:"/api/v1/knowledge/file/delete",data:{ids:i}})}function ce(i){return S.request({method:"post",url:"/api/v1/knowledge/file/parse/start",data:{document_ids:i}})}function ue(i){return S.request({method:"post",url:"/api/v1/knowledge/file/parse/stop",data:{document_ids:i}})}function at(i,p){return S.request({method:"get",url:`/api/v1/knowledge/file/chunks/${i}`,params:p})}function ot(i,p){return S.request({headers:{"Content-Type":"multipart/form-data"},method:"post",url:`/api/v1/knowledge/file/upload/${i}`,data:p})}function st(i){return S.request({method:"get",url:`/api/preview/${i}`,params:{}})}const lt={class:"tree-container"},it={style:{"margin-top":"20px"}},rt={style:{"margin-top":"20px"}},dt=["title","onClick"],ct={class:"file-number"},ut={__name:"Tree",emits:["setSelectedTreeKey"],setup(i,{emit:p}){const f=r(0),v=r([]),m=r(!1),u=r(""),g=r(""),A=r(!1),k=r({}),c=r([]),F=p,b=r(ge().isAdministrator());le(async()=>{await _();const s=x(v.value);c.value=[s],F("setSelectedTreeKey",c.value[0])});const h=(s,n)=>{c.value[0]!==s[0]&&(c.value=s,F("setSelectedTreeKey",c.value[0]))},x=s=>{let n=s[0];for(;n.children.length>0;)n=n.children[0];return n.id},_=async()=>{const s=await Xe();v.value=[s]},B=s=>{if(k.value=s,!!s.menuKey)switch(s.menuKey){case"newNode":I();break;case"rename":U(s);break;case"delete":K();break}},I=s=>{A.value=!0,m.value=!0},K=s=>{j.confirm({title:"确认删除该节点?",content:"删除后，节点不可恢复",okText:"确定",cancelText:"取消",onOk(){return tt(k.value.id).then(()=>{O.success("删除成功"),_()})},onCancel(){}})},U=s=>{debugger;u.value=s.name,f.value=s.sortOrder,g.value=s.description,m.value=!0},C=async()=>{if(!u.value){O.warning("请输入节点名称");return}if(A.value){const s={pid:k.value.id,name:u.value,sortOrder:f.value||0,description:g.value};await $e(s).catch(P=>{O.warning("节点名称存在重复，请重新输入")})&&(_(),O.success("新增成功"),k.value={},m.value=!1,f.value=0)}else{const s={name:u.value,sortOrder:k.value.sortOrder,description:g.value};await et(k.value.id,s).catch(P=>{O.warning("节点名称存在重复，请重新输入")})&&(_(),O.success("修改成功"),k.value={},m.value=!1,f.value=0)}A.value=!1};return(s,n)=>{const P=Oe,w=pe,G=Ke,N=j,X=ve,Y=me,$=fe,ee=Ne,te=Ae;return T(),J("div",lt,[o(N,{visible:e(m),"onUpdate:visible":n[3]||(n[3]=t=>Q(m)?m.value=t:null),title:e(A)?"新增节点":"修改节点","cancel-text":"取消","ok-text":"确认",onOk:C},{default:a(()=>[d("div",null,[n[4]||(n[4]=d("span",{style:{color:"red"}},"*",-1)),n[5]||(n[5]=y(" 顺序: ")),d("div",null,[o(P,{id:"inputNumber",value:e(f),"onUpdate:value":n[0]||(n[0]=t=>Q(f)?f.value=t:null),min:0},null,8,["value"])])]),d("div",it,[n[6]||(n[6]=d("span",{style:{color:"red"}},"*",-1)),n[7]||(n[7]=y("节点名称：")),o(w,{value:e(u),"onUpdate:value":n[1]||(n[1]=t=>Q(u)?u.value=t:null),placeholder:"请输入节点名称"},null,8,["value"])]),d("div",rt,[n[8]||(n[8]=y(" 节点描述:")),o(G,{value:e(g),"onUpdate:value":n[2]||(n[2]=t=>Q(g)?g.value=t:null),placeholder:"请输入节点描述",rows:4},null,8,["value"])])]),_:1},8,["visible","title"]),e(v).length?(T(),D(te,{key:0,"tree-data":e(v),blockNode:!0,virtual:!1,fieldNames:{children:"children",title:"name",key:"id"},defaultExpandAll:!0,selectedKeys:e(c)},{title:a(({kdb_id:t,id:l,description:M,name:L,children:H,sort_order:q,document_num:ne})=>[o(ee,{trigger:["contextmenu"]},Pe({default:a(()=>[d("span",{class:"node-content",title:M||L,onClick:V=>h([l])},[H&&H.length!==0?(T(),D(X,{key:0,name:"wjj",style:{width:"15px",height:"15px",display:"inline-block",position:"relative",bottom:"2px"}})):E("",!0),y(" "+z(L)+" ",1),d("span",ct,"（"+z(ne)+"）",1)],8,dt)]),_:2},[e(b)?{name:"overlay",fn:a(()=>[o($,{onClick:({key:V})=>B({name:L,kdb_id:t,id:l,menuKey:V,sortOrder:q,description:M})},{default:a(()=>[o(Y,{key:"newNode"},{icon:a(()=>[o(e(Je))]),default:a(()=>[n[9]||(n[9]=y(" 新建节点 "))]),_:1}),o(Y,{key:"rename"},{icon:a(()=>[o(e(We))]),default:a(()=>[n[10]||(n[10]=y(" 修改 "))]),_:1}),o(Y,{key:"delete",danger:""},{icon:a(()=>[o(e(He))]),default:a(()=>[n[11]||(n[11]=y(" 删除 "))]),_:1})]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)]),_:1},8,["tree-data","selectedKeys"])):E("",!0)])}}},pt=W(ut,[["__scopeId","data-v-684f8dfa"]]),mt="data:image/png;base64,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",ft={class:"upload-actions"},vt={class:"tip"},gt={__name:"UpLoadFileModal",props:{modalOpen:{type:Boolean,default:!1},selectedTreeKey:{type:String,default:""}},emits:["update:modalOpen","upload-success"],setup(i,{emit:p}){Be().get(ze.TOKEN_NAME);const v=i,m=p,u=r([]),g=r(!1),A=b=>{const h=["doc","docx","pdf","ppt","txt"],x=b.type.startsWith("image/"),_=b.name.split(".").pop().toLowerCase();return!h.includes(_)&&!x?(O.error("仅支持上传文档（doc/docx/pdf/ppt/txt）或图片文件"),!1):(u.value=[...u.value,b],!1)},k=async()=>{var h,x;if(u.value.length===0)return;g.value=!0;const b=new FormData;u.value.forEach(_=>{b.append("files",_.originFileObj)});try{await ot(v.selectedTreeKey,b),O.success("上传成功"),u.value=[],c()}catch(_){O.error("上传失败: "+(((x=(h=_.response)==null?void 0:h.data)==null?void 0:x.message)||_.message))}finally{uploading.value=!1}},c=()=>{g.value=!1,m("update:modalOpen",!1)},F=()=>{m("update:modalOpen",!1)};return(b,h)=>{const x=xe,_=j;return T(),D(_,{style:{width:"50%"},visible:i.modalOpen,title:"上传文档","cancel-text":"取消","confirm-loading":g.value,destroyOnClose:!0,"ok-text":"开始上传",onOk:k,onCancel:F},{default:a(()=>[o(x,{fileList:u.value,"onUpdate:fileList":h[0]||(h[0]=B=>u.value=B),name:"files",multiple:!0,accept:".doc,.docx,.pdf,.ppt,.txt,image/*","before-upload":A,onChange:b.handleChange,onDrop:b.handleDrop,showUploadList:{showRemoveIcon:!g.value}},{default:a(()=>h[1]||(h[1]=[d("div",{class:"ant-upload-drag-icon"},[d("img",{src:mt}),d("p",{style:{color:"#4687fe","font-weight":"600"}},"上传本地文件")],-1)])),_:1},8,["fileList","onChange","onDrop","showUploadList"]),d("div",ft,[d("span",vt,"已选择 "+z(u.value.length)+" 个文件",1)])]),_:1},8,["visible","confirm-loading"])}}},_t=W(gt,[["__scopeId","data-v-a50429ec"]]),yt={class:"slice-main"},wt={class:"pdf"},ht={class:"slice-content"},kt={class:"slice-list"},bt={class:"slice-number"},Tt={class:"list-main beautify-scrollbar"},Ot=["onClick"],Kt={class:"seq"},Nt=["innerHTML"],At={__name:"DetailSliceModal",props:{modalOpen:{type:Boolean,default:!1},title:{type:String,default:""},documentId:{type:String,default:""}},emits:["update:modalOpen"],setup(i,{emit:p}){const f=r("1");r(6);const v=r(""),m=r([]),u=r(""),g=r(""),A=r(null),k=i,c=se({current:1,pageSize:10,total:50,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:I=>`共 ${I} 条`});le(async()=>{_();const I=await st(k.documentId);g.value=I.previewUrl,A.value.contentWindow.postMessage({fileUrl:`${u.value}${g.value}`}),console.log()});const F=p,b=()=>{F("update:modalOpen",!1)},h=()=>{F("update:modalOpen",!1)},x=I=>{v.value=I.id},_=async(I={})=>{try{const K={page:c.current,pageSize:c.pageSize},U=await at(k.documentId,K);c.total=U.data.total,m.value=U.data.chunks,console.log("Fetch data with params:",I)}catch{O.error("数据加载失败")}finally{}},B=()=>{_()};return(I,K)=>{const U=ve,C=Ie,s=Se,n=Ce,P=j;return T(),D(P,{style:{width:"100vw",top:0,paddingBottom:0,maxWidth:"auto",margin:"0px"},bodyStyle:{height:"calc(100vh - 55px)",overflowY:"auto",padding:"0px"},visible:i.modalOpen,title:i.title,"cancel-text":"取消","ok-text":"确认",onOk:b,onCancel:h,footer:null,destroyOnClose:!0},{default:a(()=>[d("div",yt,[d("div",wt,[d("iframe",{src:"/pdf-view/index.html",ref_key:"iframe",ref:A,style:{width:"100%",height:"100%"}},null,512)]),d("div",ht,[o(n,{activeKey:e(f),"onUpdate:activeKey":K[2]||(K[2]=w=>Q(f)?f.value=w:null)},{default:a(()=>[o(s,{key:"1",tab:"段落"},{default:a(()=>[d("div",kt,[d("div",bt,[o(U,{name:"sliceNumber",style:{width:"18px",height:"18px"}}),y("段落拆分（"+z(e(c).total)+"） ",1)]),d("div",Tt,[(T(!0),J(Ge,null,Qe(e(m),(w,G)=>(T(),J("div",{class:Ve(["list-item",{"choosed-slice":e(v)===w.id}]),key:w.id,onClick:N=>x(w)},[d("div",Kt,z(G+1<10?`0${G+1}`:G+1)+".",1),d("div",{class:"content",innerHTML:w.content},null,8,Nt)],10,Ot))),128))]),o(C,{current:e(c).current,"onUpdate:current":K[0]||(K[0]=w=>e(c).current=w),"page-size":e(c).pageSize,"onUpdate:pageSize":K[1]||(K[1]=w=>e(c).pageSize=w),total:e(c).total,"show-total":e(c).showTotal,showSizeChanger:e(c).showSizeChanger,pageSizeOptions:e(c).pageSizeOptions,onChange:B},null,8,["current","page-size","total","show-total","showSizeChanger","pageSizeOptions"])])]),_:1})]),_:1},8,["activeKey"])])])]),_:1},8,["visible","title"])}}},xt=W(At,[["__scopeId","data-v-eafb2996"]]),It={class:"knowledge-table-container"},St={class:"main-content"},Ct={class:"search-section"},Dt={class:"table-section"},Ft={__name:"KnowledgeTable",props:{selectedTreeKey:{type:String,required:!0}},setup(i){const p=r(ge().isAdministrator()),f=r([]);r(!1);const v=r(!1),m=r(!1),u=r(""),g=r("开始解析"),A=r("");let k=null;const c={UNSTART:"待解析",RUNNING:"解析中",CANCEL:"已取消",DONE:"已入库",FAIL:"入库失败"},F={UNSTART:"开始解析",RUNNING:"停止解析",CANCEL:"重新解析",DONE:"查看",FAIL:"重新解析"},b={UNSTART:"",RUNNING:"",CANCEL:"",DONE:"#389e0d",FAIL:"#ff4d4f"},h=i,x=()=>{v.value=!0},_=t=>{g.value=t.key};ie(()=>h.selectedTreeKey,t=>{Object.assign(C,{name:""}),w.value=!1,s.current=1,N()}),ie(()=>v.value,t=>{t||N()});const B=t=>{j.confirm({title:"确认删除该文件?",content:"删除后，文件不可恢复",okText:"确定",cancelText:"取消",onOk(){return de([t.id]).then(l=>{O.success("删除成功"),N()})},onCancel(){}})},I=[{title:"文档名称",dataIndex:"name",ellipsis:!0},{title:"上传人",dataIndex:"username",width:80,ellipsis:!0},{title:"上传时间",dataIndex:"create_time",width:100,sorter:(t,l)=>oe(t.createTime)-oe(l.createTime),customRender:({text:t})=>oe(Number(t)).format("YYYY-MM-DD HH:mm:ss")},{title:"文档状态",dataIndex:"run",width:80,align:"center"},{title:"文档类型",dataIndex:"type",width:80,align:"center"},{title:"操作",dataIndex:"operation",width:150,align:"center",fixed:"right"}],K=t=>{Object.assign(s,t),N()},U=r([]),C=se({name:""}),s=se({current:1,pageSize:10,total:50,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:t=>`共 ${t} 条`}),n=r(!1),P=r(!1),w=r(!1);le(()=>{k=setInterval(()=>{N(!0)},5e3)}),Ye(()=>{clearInterval(k)});const G=t=>{f.value=t},N=async t=>{try{t||(n.value=!0);const l={...C,page:s.current,pageSize:s.pageSize},M=await nt(h.selectedTreeKey,l);s.total=M.data.total,U.value=M.data.docs}catch{O.error("数据加载失败")}finally{n.value=!1}},X=()=>{w.value=!0,N()},Y=()=>{Object.assign(C,{name:""}),w.value=!1,N()},$=t=>{m.value=!0,u.value=t.name,A.value=t.id},ee=async()=>{const t=f.value;switch(g.value){case"开始解析":await ce(t),O.success("已批量开始解析");break;case"结束解析":await ue(t),O.success("已批量结束解析");break;default:de(t).then(l=>{O.success("批量删除成功")})}f.value=[],N()},te=async t=>{const l=["UNSTART","CANCEL","FAIL"],M=["RUNNING"],L=t.run;l.includes(L)?(await ce([t.id]),N()):M.includes(L)?(await ue([t.id]),N()):$(t)};return(t,l)=>{const M=pe,L=De,H=re("SearchOutlined"),q=Fe,ne=re("UndoOutlined"),V=Ue,_e=Me,ae=me,ye=fe,we=Le,he=qe,ke=Re,be=Ee;return T(),J("div",It,[o(_t,{modalOpen:e(v),"onUpdate:modalOpen":l[0]||(l[0]=R=>Q(v)?v.value=R:null),selectedTreeKey:i.selectedTreeKey},null,8,["modalOpen","selectedTreeKey"]),e(m)?(T(),D(xt,{key:0,modalOpen:e(m),"onUpdate:modalOpen":l[1]||(l[1]=R=>Q(m)?m.value=R:null),title:e(u),documentId:e(A)},null,8,["modalOpen","title","documentId"])):E("",!0),d("div",St,[d("div",Ct,[o(_e,{model:e(C),layout:"inline",class:"advanced-search-form",onSubmit:Ze(X,["prevent"])},{default:a(()=>[o(L,{label:"文档名称",class:"form-item-custom"},{default:a(()=>[o(M,{value:e(C).name,"onUpdate:value":l[2]||(l[2]=R=>e(C).name=R),placeholder:"请输入关键字进行搜索",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1}),o(L,{class:"form-item-custom"},{default:a(()=>[o(V,{size:16},{default:a(()=>[o(q,{"html-type":"submit",loading:e(P),type:"primary"},{icon:a(()=>[o(H)]),default:a(()=>[l[3]||(l[3]=y(" 搜索 "))]),_:1},8,["loading"]),o(q,{onClick:Y,class:"main-btn"},{icon:a(()=>[o(ne)]),default:a(()=>[l[4]||(l[4]=y(" 重置 "))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),d("div",Dt,[o(V,{size:16,style:{"margin-bottom":"20px"}},{default:a(()=>[e(p)?(T(),D(q,{key:0,type:"primary",onClick:x},{default:a(()=>l[5]||(l[5]=[y(" 上传文档 ")])),_:1})):E("",!0),o(we,{onClick:ee,type:"primary"},{overlay:a(()=>[o(ye,{onClick:_},{default:a(()=>[o(ae,{key:"开始解析"},{default:a(()=>l[6]||(l[6]=[y(" 开始解析 ")])),_:1}),o(ae,{key:"结束解析"},{default:a(()=>l[7]||(l[7]=[y(" 结束解析 ")])),_:1}),o(ae,{key:"删除"},{default:a(()=>l[8]||(l[8]=[y("删除")])),_:1})]),_:1})]),default:a(()=>[y(z(e(g))+" ",1)]),_:1})]),_:1}),o(be,{"row-selection":{selectedRowKeys:e(f),onChange:G},columns:I,loading:e(n),"data-source":e(U),pagination:e(s),scroll:{x:500,y:"calc(100vh - 300px)"},bordered:"",size:"middle","row-key":"id",sticky:"",onChange:K},{bodyCell:a(({column:R,record:Z})=>[R.dataIndex==="run"?(T(),D(q,{key:0,type:"link",size:"small",style:je({color:b[Z.run]})},{default:a(()=>[y(z(c[Z.run]),1)]),_:2},1032,["style"])):E("",!0),R.dataIndex==="operation"?(T(),D(V,{key:1,size:4},{default:a(()=>[o(q,{type:"link",size:"small",onClick:Te=>te(Z)},{default:a(()=>[y(z(F[Z.run]),1)]),_:2},1032,["onClick"]),e(p)?(T(),D(he,{key:0,type:"vertical"})):E("",!0),e(p)?(T(),D(q,{key:1,type:"link",size:"small",style:{color:"#ea3333"},onClick:Te=>B(Z)},{default:a(()=>l[9]||(l[9]=[y(" 删除 ")])),_:2},1032,["onClick"])):E("",!0)]),_:2},1024)):E("",!0)]),emptyText:a(()=>[o(ke,{description:e(w)?"暂无相关数据":"暂无数据"},null,8,["description"])]),_:1},8,["row-selection","loading","data-source","pagination"])])])])}}},Ut=W(Ft,[["__scopeId","data-v-bd41475e"]]),Mt={class:"knowledge"},Lt={class:"tree"},qt={id:"knowledge-table"},Rt={__name:"index",setup(i){const p=r(""),f=v=>{p.value=v};return(v,m)=>(T(),J("div",Mt,[d("div",Lt,[o(pt,{onSetSelectedTreeKey:f})]),d("div",qt,[o(Ut,{selectedTreeKey:e(p)},null,8,["selectedTreeKey"])])]))}},cn=W(Rt,[["__scopeId","data-v-26504267"]]);export{cn as default};
